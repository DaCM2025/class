<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-be2dad9397c9b99732ed2a04f2c65f62.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-99.9.9">

  <meta name="author" content="Samuel Orso">
  <meta name="dcterms.date" content="2025-11-06">
  <title>Lecture 4 — Software Engineering for Data Science</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-4672a6d53a7f172c9e50360c0960cbcc.css">
  <link rel="stylesheet" href="theme_dacm.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Lecture 4 — Software Engineering for Data Science</h1>
  <p class="subtitle">Data &amp; Code Management: From Collection to Application</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Samuel Orso 
</div>
</div>
</div>

  <p class="date">2025-11-06</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/r-packages-structure-workflow-best-practices" id="/toc-r-packages-structure-workflow-best-practices">R packages — Structure, workflow, best practices</a></li>
<li><a href="#/creating-a-python-library" id="/toc-creating-a-python-library">Creating a Python Library</a></li>
<li><a href="#/object-oriented-programming" id="/toc-object-oriented-programming">Object-Oriented Programming</a></li>
<li><a href="#/functional-programming" id="/toc-functional-programming">Functional Programming</a></li>
</ul>
</nav>
</section>
<section class="slide level2">

</section>
<section>
<section id="r-packages-structure-workflow-best-practices" class="title-slide slide level1 center">
<h1>R packages — Structure, workflow, best practices</h1>

</section>
<section id="why-make-an-r-package" class="slide level2">
<h2>Why make an R package?</h2>
<ul>
<li class="fragment">Distribute code to others — packaging nudges you to <strong>write documentation</strong>.</li>
<li class="fragment">Enforces <strong>conventions</strong> (files, names, processes).</li>
<li class="fragment">Increases <strong>stability</strong> via long-term maintenance + <strong>testing</strong>.</li>
<li class="fragment">Improves <strong>usability</strong> as your function zoo grows.</li>
<li class="fragment">Clear API, versioning, and easier onboarding for collaborators.</li>
</ul>
</section>
<section id="setup" class="slide level2">
<h2>Setup</h2>
<p>You will need (at least) the following packages:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"devtools"</span>, <span class="st">"knitr"</span>, <span class="st">"pkgdown"</span>, <span class="st">"roxygen2"</span>, <span class="st">"testthat"</span>, <span class="st">"usethis"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Check your system toolchain:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>devtools<span class="sc">::</span><span class="fu">has_devel</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If not ready: <a href="https://r-pkgs.org/setup.html">https://r-pkgs.org/setup.html</a></p>
</section>
<section id="demo" class="slide level2 center middle">
<h2>Demo</h2>
<p>(We’ll live-code a tiny package: init → a function → docs → tests → pkgdown.)</p>
</section>
<section id="package-anatomy" class="slide level2">
<h2>Package anatomy</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a></a>pkgtest/</span>
<span id="cb3-2"><a></a>├─ DESCRIPTION</span>
<span id="cb3-3"><a></a>├─ NAMESPACE          # auto-generated by roxygen2</span>
<span id="cb3-4"><a></a>├─ R/                 # your exported/internal functions</span>
<span id="cb3-5"><a></a>├─ man/               # *.Rd docs (generated)</span>
<span id="cb3-6"><a></a>├─ tests/testthat/    # unit tests</span>
<span id="cb3-7"><a></a>├─ vignettes/         # long-form docs (optional)</span>
<span id="cb3-8"><a></a>├─ data/              # .rda datasets (optional)</span>
<span id="cb3-9"><a></a>├─ inst/              # e.g., inst/examples/</span>
<span id="cb3-10"><a></a>└─ data-raw/          # raw data + scripts (ignored by build)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="description-file" class="slide level2">
<h2>DESCRIPTION file</h2>
<p><code>DESCRIPTION</code> contains package metadata (authors, description, dependencies, contact, …). Example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># Plain text (DCF) — shown here for reference</span></span>
<span id="cb4-2"><a></a>Package<span class="sc">:</span> pkgtest</span>
<span id="cb4-3"><a></a>Type<span class="sc">:</span> Package</span>
<span id="cb4-4"><a></a>Title<span class="sc">:</span> What the Package <span class="fu">Does</span> (Title Case)</span>
<span id="cb4-5"><a></a>Version<span class="sc">:</span> <span class="dv">0</span>.<span class="fl">1.0</span></span>
<span id="cb4-6"><a></a>Authors<span class="sc">@</span>R<span class="sc">:</span> <span class="fu">person</span>(<span class="st">"John"</span>, <span class="st">"Doe"</span>, <span class="at">email =</span> <span class="st">"john.doe@example.com"</span>,</span>
<span id="cb4-7"><a></a>  <span class="at">role =</span> <span class="fu">c</span>(<span class="st">"aut"</span>, <span class="st">"cre"</span>))</span>
<span id="cb4-8"><a></a>Maintainer<span class="sc">:</span> John Doe <span class="sc">&lt;</span>john.doe<span class="sc">@</span>example.com<span class="sc">&gt;</span></span>
<span id="cb4-9"><a></a>Description<span class="sc">:</span> More about what it <span class="fu">does</span> (maybe more than one line).</span>
<span id="cb4-10"><a></a>    Use four spaces when indenting paragraphs within the Description.</span>
<span id="cb4-11"><a></a>License<span class="sc">:</span> MIT <span class="sc">+</span> file LICENSE</span>
<span id="cb4-12"><a></a>Encoding<span class="sc">:</span> UTF<span class="dv">-8</span></span>
<span id="cb4-13"><a></a>LazyData<span class="sc">:</span> true</span>
<span id="cb4-14"><a></a>URL<span class="sc">:</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ptds2024<span class="sc">/</span>pkgtest</span>
<span id="cb4-15"><a></a>BugReports<span class="sc">:</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ptds2024<span class="sc">/</span>pkgtest<span class="sc">/</span>issues</span>
<span id="cb4-16"><a></a>Roxygen<span class="sc">:</span> <span class="fu">list</span>(<span class="at">markdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-17"><a></a>RoxygenNote<span class="sc">:</span> <span class="dv">7</span>.<span class="fl">3.1</span></span>
<span id="cb4-18"><a></a>Suggests<span class="sc">:</span></span>
<span id="cb4-19"><a></a>    knitr,</span>
<span id="cb4-20"><a></a>    rmarkdown,</span>
<span id="cb4-21"><a></a>    <span class="fu">testthat</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">0.0</span>)</span>
<span id="cb4-22"><a></a>Config<span class="sc">/</span>testthat<span class="sc">/</span>edition<span class="sc">:</span> <span class="dv">3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Tip: <code>usethis::use_description()</code> can scaffold this for you.</p>
</section>
<section id="authors-and-license" class="slide level2">
<h2>Authors and license</h2>
<p>Use <code>person()</code> in <code>Authors@R</code>. Common roles:</p>
<ul>
<li><code>"cre"</code> = maintainer (creator)</li>
<li><code>"aut"</code> = author (substantial contributions)</li>
<li><code>"ctb"</code> = contributor (smaller contributions)</li>
<li><code>"cph"</code> = copyright holder (institution/corporate)</li>
</ul>
<p>Choose a license: <a href="https://choosealicense.com/licenses/">https://choosealicense.com/licenses/</a></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>()</span>
<span id="cb5-2"><a></a><span class="co"># Alternatives: usethis::use_gpl3_license(), use_apl2_license(), …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="dependencies" class="slide level2">
<h2>Dependencies</h2>
<p><code>DESCRIPTION</code> lists what your package needs.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>Depends<span class="sc">:</span> <span class="fu">R</span> (<span class="sc">&gt;=</span> <span class="dv">4</span>.<span class="fl">0.0</span>)    <span class="co"># note the space!</span></span>
<span id="cb6-2"><a></a>Imports<span class="sc">:</span></span>
<span id="cb6-3"><a></a>    <span class="fu">dplyr</span> (<span class="sc">&gt;=</span> <span class="dv">1</span>.<span class="fl">1.4</span>),</span>
<span id="cb6-4"><a></a>    <span class="fu">ggplot2</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">5.1</span>)</span>
<span id="cb6-5"><a></a>Suggests<span class="sc">:</span></span>
<span id="cb6-6"><a></a>    knitr,</span>
<span id="cb6-7"><a></a>    rmarkdown,</span>
<span id="cb6-8"><a></a>    <span class="fu">testthat</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">0.0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Guidelines:</p>
<ul>
<li><code>Imports</code> for <code>fun()</code> used in codes in <code>R/</code>.</li>
<li><code>Depends</code> for base R version requirement.</li>
<li><code>Suggests</code> for docs, tests, vignettes.</li>
<li>Note: for selective namespace import, use roxygen tags such as: <code>@importFrom dplyr mutate select</code>.</li>
</ul>
</section>
<section id="documenting-your-package" class="slide level2">
<h2>Documenting your package</h2>
<ul>
<li>Docs live in <code>man/</code> as <code>*.Rd</code> (generated).</li>
<li>We generate them with <strong>roxygen2</strong> from inline comments.</li>
<li>Run <code>devtools::document()</code> to update <code>NAMESPACE</code> + <code>man/</code>.</li>
</ul>

<img data-src="images/roxygen2.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="roxygen-basics" class="slide level2">
<h2>Roxygen basics</h2>
<p>Place roxygen just <strong>above</strong> the function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co">#' Say hello</span></span>
<span id="cb7-2"><a></a><span class="co">#'</span></span>
<span id="cb7-3"><a></a><span class="co">#' @return Prints a friendly message.</span></span>
<span id="cb7-4"><a></a><span class="co">#' @examples</span></span>
<span id="cb7-5"><a></a><span class="co">#' hello()</span></span>
<span id="cb7-6"><a></a><span class="co">#' @export</span></span>
<span id="cb7-7"><a></a>hello <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-8"><a></a>  <span class="fu">print</span>(<span class="st">"Hello, world!"</span>)</span>
<span id="cb7-9"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Useful tags: <code>@title</code>, <code>@description</code>, <code>@details</code>, <code>@param</code>, <code>@return</code>, <code>@examples</code>, <code>@seealso</code>, <code>@author</code>, <code>@references</code>, <code>@import</code>, <code>@importFrom</code>, <code>@export</code></p>
<p><strong>Document all</strong> user-facing functions; <strong>export some</strong> of them.</p>
</section>
<section id="example-hello-docs-vs.-help-page" class="slide level2">
<h2>Example: hello() (docs vs.&nbsp;help page)</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/pkgtest_hello_world.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co">#' @title hello world function</span></span>
<span id="cb8-2"><a></a><span class="co">#' @details A super fancy function to print Hello World!</span></span>
<span id="cb8-3"><a></a><span class="co">#' @return Prints a message.</span></span>
<span id="cb8-4"><a></a><span class="co">#' @examples</span></span>
<span id="cb8-5"><a></a><span class="co">#' hello()</span></span>
<span id="cb8-6"><a></a><span class="co">#' @export</span></span>
<span id="cb8-7"><a></a>hello <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb8-8"><a></a>  <span class="fu">print</span>(<span class="st">"Hello, world!"</span>)</span>
<span id="cb8-9"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="import-external-functions-explicitly" class="slide level2">
<h2>Import external functions explicitly</h2>
<p><strong>Rule:</strong> If you call functions from another package, you <strong>must</strong> import them with roxygen’s <code>@importFrom</code> so <code>NAMESPACE</code> lists them.</p>
<p>It is not sufficient to add <code>pkg::fun()</code> calls in your code.</p>
<p>Otherwise you’ll hit <code>R CMD check</code> NOTES like <em>“no visible global function definition for ‘select’”</em> and users may get runtime errors.</p>
<p><em>Note:</em> Base R functions (e.g., <code>mean()</code>, <code>lm()</code>) do not need imports.</p>
<p><strong>Do (bare names + explicit imports):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co">#' Transform helper</span></span>
<span id="cb9-2"><a></a><span class="co">#'</span></span>
<span id="cb9-3"><a></a><span class="co">#' @description Example using dplyr without pkg:: qualification.</span></span>
<span id="cb9-4"><a></a><span class="co">#' @importFrom dplyr select mutate</span></span>
<span id="cb9-5"><a></a><span class="co">#' @export</span></span>
<span id="cb9-6"><a></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb9-7"><a></a>  df <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a></a>    <span class="fu">select</span>(x, y) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a></a>    <span class="fu">mutate</span>(<span class="at">z =</span> x <span class="sc">+</span> y)</span>
<span id="cb9-10"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="adding-data-binary-.rda" class="slide level2">
<h2>Adding data (binary .rda)</h2>
<ul>
<li>Place datasets in <code>data/</code> as <code>.rda</code>.</li>
<li>Use <code>usethis::use_data()</code> to serialize R objects.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>snipes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data-raw/snipes.csv"</span>)</span>
<span id="cb10-2"><a></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(snipes, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)  <span class="co"># creates data/snipes.rda</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="preserve-the-origin-story-data-raw" class="slide level2">
<h2>Preserve the origin story (data-raw)</h2>
<ul>
<li>Keep raw inputs + wrangling scripts under <code>data-raw/</code>.</li>
<li>Make it reproducible with <code>usethis::use_data_raw()</code> (auto-adds to <code>.Rbuildignore</code>).</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_data_raw</span>(<span class="st">"snipes"</span>)</span>
<span id="cb11-2"><a></a><span class="co"># edit data-raw/snipes.R to read/clean/write snipes object, then use_data()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Reference: r-pkgs, “Preserve the origin story of package data”.</p>
</section>
<section id="documenting-datasets" class="slide level2">
<h2>Documenting datasets</h2>
<p>Two useful tags: <code>@format</code> and <code>@source</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co">#' Snipes price data</span></span>
<span id="cb12-2"><a></a><span class="co">#'</span></span>
<span id="cb12-3"><a></a><span class="co">#' @format A data frame with 48 rows and 3 columns:</span></span>
<span id="cb12-4"><a></a><span class="co">#' \describe{</span></span>
<span id="cb12-5"><a></a><span class="co">#'   \item{discount}{Discounted price of sneakers}</span></span>
<span id="cb12-6"><a></a><span class="co">#'   \item{brand}{Brand of sneakers}</span></span>
<span id="cb12-7"><a></a><span class="co">#'   \item{price}{Original price of sneakers}</span></span>
<span id="cb12-8"><a></a><span class="co">#' }</span></span>
<span id="cb12-9"><a></a><span class="co">#' @source &lt;https://www.snipes.ch/&gt;</span></span>
<span id="cb12-10"><a></a><span class="st">"snipes"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="rbuildignore" class="slide level2">
<h2>.Rbuildignore</h2>
<p>Like <code>.gitignore</code>, but for package builds.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_build_ignore</span>(<span class="fu">c</span>(<span class="st">"^.*</span><span class="sc">\\</span><span class="st">.Rproj$"</span>, <span class="st">"^</span><span class="sc">\\</span><span class="st">.Rproj</span><span class="sc">\\</span><span class="st">.user$"</span>, <span class="st">"^LICENSE</span><span class="sc">\\</span><span class="st">.md$"</span>, <span class="st">"^</span><span class="sc">\\</span><span class="st">.github$"</span>, <span class="st">"^data-raw$"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Or maintain manually:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb14-1"><a></a>^.*\.Rproj$</span>
<span id="cb14-2"><a></a>^\.Rproj\.user$</span>
<span id="cb14-3"><a></a>^LICENSE\.md$</span>
<span id="cb14-4"><a></a>^\.github$</span>
<span id="cb14-5"><a></a>^data-raw$</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="vignettes" class="slide level2">
<h2>Vignettes</h2>
<p>Long-form docs (articles, tutorials) built with R Markdown/Quarto.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_vignette</span>(<span class="st">"getting-started"</span>)</span>
<span id="cb15-2"><a></a><span class="co"># Write vignettes/getting-started.Rmd (or .qmd)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Remember to list <code>knitr</code> and <code>rmarkdown</code> under <code>Suggests</code>.</p>
</section>
<section id="namespaces-how-functions-are-found" class="slide level2">
<h2>Namespaces (how functions are found)</h2>
<blockquote>
<p>The namespace controls how R looks up variables: it searches your package namespace, then imports, then base, then the regular search path.</p>
</blockquote>
<ul>
<li><strong>Generated automatically</strong> by roxygen2.</li>
<li>Use <code>@export</code> to expose a function; <code>@importFrom pkg fun</code> to bring symbols in.</li>
</ul>
</section>
<section id="a-toy-function-to-test" class="slide level2">
<h2>A toy function to test</h2>
<p>In <code>R/reg_coef.R</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="co">#' Compute regression coefficients</span></span>
<span id="cb16-2"><a></a><span class="co">#'</span></span>
<span id="cb16-3"><a></a><span class="co">#' @param x Design \code{matrix} or vector.</span></span>
<span id="cb16-4"><a></a><span class="co">#' @param y Response \code{vector}.</span></span>
<span id="cb16-5"><a></a><span class="co">#' @details Uses \link[stats]{lm} then \link[stats]{coef}.</span></span>
<span id="cb16-6"><a></a><span class="co">#' @importFrom stats lm coef</span></span>
<span id="cb16-7"><a></a><span class="co">#' @seealso \code{\link[stats]{lm}}, \code{\link[stats]{coef}}</span></span>
<span id="cb16-8"><a></a><span class="co">#' @example inst/examples/eg_reg_coef.R</span></span>
<span id="cb16-9"><a></a><span class="co">#' @export</span></span>
<span id="cb16-10"><a></a><span class="st">`</span><span class="at">%r%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x) {</span>
<span id="cb16-11"><a></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb16-12"><a></a>  <span class="fu">coef</span>(fit)</span>
<span id="cb16-13"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="testing-via-examples" class="slide level2">
<h2>“Testing” via examples</h2>
<ul>
<li>Examples (in roxygen) are <strong>shown to users</strong> and run under <code>R CMD check</code>.</li>
<li>For bigger snippets, place files under <code>inst/examples/</code> and reference them:</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co">#' @examples</span></span>
<span id="cb17-2"><a></a><span class="co">#' @example inst/examples/eg_reg_coef.R</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>inst/examples/eg_reg_coef.R</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="do">## linear regression</span></span>
<span id="cb18-2"><a></a>cars<span class="sc">$</span>speed <span class="sc">%r%</span> cars<span class="sc">$</span>dist</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="what-happens-on-check" class="slide level2">
<h2>What happens on check?</h2>

<img data-src="images/pkg_check.png" style="width:70.0%" class="r-stretch"></section>
<section id="intentional-mistake-to-see-failure" class="slide level2">
<h2>Intentional mistake (to see failure)</h2>
<p>If <code>inst/examples/eg_reg_coef.R</code> contains:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>cars<span class="sc">$</span>speed <span class="sc">%r%</span> cars   <span class="co"># wrong!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>You’ll get a failing check:</p>

<img data-src="images/pkg_check2.png" style="width:70.0%" class="r-stretch"></section>
<section id="testing-with-testthat" class="slide level2">
<h2>Testing with <strong>testthat</strong></h2>
<p>Examples are for users; <strong>tests</strong> are for you (broader, automated).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote>
<p>“Whenever you are tempted to type something into a print statement or a debugger expression, write it as a test instead.” — Martin Fowler</p>
</blockquote>
</section>
<section id="testthat-structure" class="slide level2">
<h2>testthat structure</h2>
<ol type="1">
<li><strong>Expectation</strong>: a single check (<code>expect_*()</code>).</li>
<li><strong>Test</strong>: one or more expectations (<code>test_that()</code>).</li>
<li><strong>Test file</strong>: one or more tests (e.g., <code>tests/testthat/test_reg_coef.R</code>).</li>
</ol>
<p>Example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">test_that</span>(<span class="st">"regression coefficient input check"</span>, {</span>
<span id="cb21-2"><a></a>  <span class="fu">expect_error</span>(cars<span class="sc">$</span>speed <span class="sc">%r%</span> cars)</span>
<span id="cb21-3"><a></a>})</span>
<span id="cb21-4"><a></a></span>
<span id="cb21-5"><a></a><span class="fu">test_that</span>(<span class="st">"regression coefficient output"</span>, {</span>
<span id="cb21-6"><a></a>  <span class="fu">expect_type</span>(cars<span class="sc">$</span>speed <span class="sc">%r%</span> cars<span class="sc">$</span>dist, <span class="st">"double"</span>)</span>
<span id="cb21-7"><a></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="continuous-integration-github-actions" class="slide level2">
<h2>Continuous Integration (GitHub Actions)</h2>
<p>Run checks on multiple R versions/OS on every push/PR:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_github_action_check_standard</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>More examples: <a href="https://github.com/r-lib/actions/tree/master/examples">https://github.com/r-lib/actions/tree/master/examples</a></p>
</section>
<section id="keep-ci-within-budget-class-org" class="slide level2">
<h2>Keep CI within budget (class org)</h2>
<ul>
<li>We have <strong>only 3000 free Actions minutes/month</strong> for the class org.</li>
<li>Prefer <strong>public repos</strong> (or <strong>self-hosted runners</strong>) → no Actions minutes used.</li>
<li>For <strong>private repos</strong>, test on your personal repo first; then fork to class org.</li>
<li>Trigger CI on <strong>PRs/manual runs</strong> and use <strong><code>paths</code> filters</strong>:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb23-1"><a></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb23-2"><a></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb23-3"><a></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb23-4"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'R/**'</span></span>
<span id="cb23-5"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'DESCRIPTION'</span></span>
<span id="cb23-6"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'NAMESPACE'</span></span>
<span id="cb23-7"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'.github/workflows/**'</span></span>
<span id="cb23-8"><a></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="keep-ci-within-budget-class-org-1" class="slide level2">
<h2>Keep CI within budget (class org)</h2>
<ul>
<li>Skip manually CI with <strong><code>[skip ci]</code></strong>:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb24-1"><a></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb24-2"><a></a><span class="at">  </span><span class="fu">check</span><span class="kw">:</span></span>
<span id="cb24-3"><a></a><span class="at">    </span><span class="fu">if</span><span class="kw">:</span><span class="at"> </span><span class="st">"!contains(github.event.head_commit.message, '[skip ci]')"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a></a><span class="fu">git</span> add README.md</span>
<span id="cb25-2"><a></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"docs: fix typos [skip ci]"</span></span>
<span id="cb25-3"><a></a><span class="fu">git</span> push</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="code-coverage-nice-enhancement" class="slide level2">
<h2>Code coverage (nice enhancement)</h2>
<p>Measure what your tests execute:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">install.packages</span>(<span class="st">"covr"</span>)</span>
<span id="cb26-2"><a></a>covr<span class="sc">::</span><span class="fu">report</span>()           <span class="co"># local HTML report</span></span>
<span id="cb26-3"><a></a>usethis<span class="sc">::</span><span class="fu">use_coverage</span>()  <span class="co"># set up Codecov (if desired)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Aim for high, but don’t chase 100% blindly — test the <strong>behavior</strong> that matters.</p>
</section>
<section id="pkgdown-package-website" class="slide level2">
<h2>pkgdown (package website)</h2>

<img data-src="images/pkgdown.png" style="position:absolute; top:30%; right:5%;" class="r-stretch"><p>Quickly create a website from your docs/vignettes:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_pkgdown</span>()    <span class="co"># run once</span></span>
<span id="cb27-2"><a></a>pkgdown<span class="sc">::</span><span class="fu">build_site</span>()     <span class="co"># build locally</span></span>
<span id="cb27-3"><a></a>usethis<span class="sc">::</span><span class="fu">use_github_action</span>(<span class="st">"pkgdown"</span>)  <span class="co"># CI deploy</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Docs: <a href="https://pkgdown.r-lib.org/">https://pkgdown.r-lib.org/</a></p>
</section>
<section id="example-site-preview" class="slide level2">
<h2>Example site preview</h2>

<img data-src="images/pkgdow_pkgtest.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="release-checklist-semver" class="slide level2">
<h2>Release checklist (SemVer)</h2>
<ul>
<li class="fragment">Update <code>NEWS.md</code> (<code>usethis::use_news_md()</code>).</li>
<li class="fragment">Bump version in <code>DESCRIPTION</code> (e.g., <code>0.1.0</code> → <code>0.2.0</code> for features).</li>
<li class="fragment"><code>devtools::check()</code> clean locally (no ERROR/WARNING/NOTE).</li>
<li class="fragment">All CI green; coverage reasonable.</li>
<li class="fragment">Rebuild site; tag the release; write a short changelog.</li>
<li class="fragment">Consider CRAN policies if submitting (e.g., <code>R CMD check --as-cran</code>).</li>
</ul>
</section>
<section id="install-from-github-user" class="slide level2">
<h2>Install from GitHub (user)</h2>
<p><strong>For users (install the released tag):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb28-2"><a></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"your-org/yourpkg"</span>, <span class="at">ref =</span> <span class="st">"v0.1.0"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-3"><a></a></span>
<span id="cb28-4"><a></a><span class="co"># Repo with a subfolder package:</span></span>
<span id="cb28-5"><a></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"your-org/your-repo"</span>, <span class="at">subdir =</span> <span class="st">"yourpkg"</span>, <span class="at">ref =</span> <span class="st">"v0.1.0"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><em>Note:</em> Building from source may require <strong>Rtools</strong> (Windows) or <strong>Xcode CLT</strong> (macOS).</p>
</section>
<section id="typical-workflow-big-picture" class="slide level2">
<h2>Typical workflow (big picture)</h2>
<ol type="1">
<li><code>usethis::create_package("pkgtest")</code></li>
<li>Write a function in <code>R/</code></li>
<li>Add roxygen docs → <code>devtools::document()</code></li>
<li>Add tests → <code>usethis::use_testthat()</code> → write <code>tests/testthat/</code></li>
<li>Check → <code>devtools::check()</code></li>
<li>CI → <code>usethis::use_github_action_check_standard()</code></li>
<li>Site → <code>usethis::use_pkgdown()</code> → <code>pkgdown::build_site()</code></li>
<li>Release checklist and version bump (SemVer)</li>
</ol>
</section>
<section id="tips-helpers-usethis" class="slide level2">
<h2>Tips &amp; helpers (usethis)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>usethis<span class="sc">::</span><span class="fu">use_readme_md</span>()</span>
<span id="cb29-2"><a></a>usethis<span class="sc">::</span><span class="fu">use_lifecycle_badge</span>(<span class="st">"maturing"</span>)</span>
<span id="cb29-3"><a></a>usethis<span class="sc">::</span><span class="fu">use_github</span>()              <span class="co"># init repo + remote</span></span>
<span id="cb29-4"><a></a>usethis<span class="sc">::</span><span class="fu">use_pipe</span>()                <span class="co"># if you want |&gt; helper or magrittr</span></span>
<span id="cb29-5"><a></a>usethis<span class="sc">::</span><span class="fu">use_tidy_description</span>()    <span class="co"># sort/format DESCRIPTION</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li><strong>Code shown here</strong>: <a href="https://github.com/ptds2024/pkgtest">https://github.com/ptds2024/pkgtest</a></li>
<li><strong>R Packages (2e)</strong>: <a href="https://r-pkgs.org/">https://r-pkgs.org/</a></li>
<li><strong>Writing R Extensions</strong>: <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">https://cran.r-project.org/doc/manuals/r-release/R-exts.html</a></li>
<li><strong>Book chapter</strong>: <em>An Introduction to Statistical Programming Methods with R</em> — Packages section: <a href="https://smac-group.github.io/ds/section-r-packages.html">https://smac-group.github.io/ds/section-r-packages.html</a></li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="creating-a-python-library" class="title-slide slide level1 center">
<h1>Creating a Python Library</h1>

</section>
<section id="why-a-python-library-r-parallels" class="slide level2">
<h2>Why a Python library (R parallels)</h2>
<ul>
<li>Distribute code, enforce <strong>conventions</strong>, improve <strong>stability</strong>.</li>
<li>R: <code>DESCRIPTION</code>, <code>NAMESPACE</code>, roxygen, <strong>testthat</strong>, <strong>pkgdown</strong><br>
</li>
<li>Py: <code>setup.py</code>/wheel, <code>__init__.py</code>, <strong>docstrings</strong>, <strong>pytest</strong>, <strong>MkDocs</strong></li>
</ul>
</section>
<section id="set-up-a-virtual-environment-vs-code" class="slide level2">
<h2>Set up a virtual environment (VS Code)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a></a><span class="ex">python3</span> <span class="at">-m</span> venv venv</span>
<span id="cb30-2"><a></a><span class="bu">source</span> venv/bin/activate     <span class="co"># Windows: venv\Scripts\activate</span></span>
<span id="cb30-3"><a></a><span class="ex">pip</span> install <span class="at">-U</span> pip setuptools wheel pytest</span>
<span id="cb30-4"><a></a><span class="ex">code</span> .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>VS Code → “Python: Select Interpreter” → pick <code>./venv</code></li>
</ul>
</section>
<section id="minimal-structure-parallel-to-r-package-anatomy" class="slide level2">
<h2>Minimal structure (parallel to R package anatomy)</h2>
<pre><code>
pypkg/                    # ← package root (like R pkg root)
├─ setup.py               # ← like DESCRIPTION (+ build recipe)
├─ MANIFEST.in            # ← include data files (like .Rbuildignore inverse)
├─ README.md
├─ pypkg/                 # ← source (like R/ folder)
│  ├─ __init__.py         # ← public API (like NAMESPACE role)
│  ├─ hello.py            # ← hello()
│  ├─ regression.py       # ← reg_coef()
│  ├─ data.py             # ← load_snipes()
│  └─ data/
│     └─ snipes.csv       # ← packaged dataset
├─ examples/
│  └─ eg_reg_coef.py      # ← like inst/examples/...
├─ tests/                 # ← pytest (like tests/testthat)
│  ├─ test_hello.py
│  ├─ test_regression.py
│  └─ test_data.py
</code></pre>
<p>We need to create these files step-by-step.</p>
</section>
<section id="create-your-project-directory-terminal-basics" class="slide level2">
<h2>Create your project directory (Terminal basics)</h2>
<p>Open your <strong>terminal</strong> (VS Code: <em>View → Terminal</em>) and create a folder for your Python library.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a></a><span class="co"># See where you are (present working directory)</span></span>
<span id="cb32-2"><a></a><span class="bu">pwd</span></span>
<span id="cb32-3"><a></a></span>
<span id="cb32-4"><a></a><span class="co"># List folders/files</span></span>
<span id="cb32-5"><a></a><span class="fu">ls</span></span>
<span id="cb32-6"><a></a></span>
<span id="cb32-7"><a></a><span class="co"># Go to the parent location where you want the project</span></span>
<span id="cb32-8"><a></a><span class="bu">cd</span> path/to/parent</span>
<span id="cb32-9"><a></a></span>
<span id="cb32-10"><a></a><span class="co"># Create and enter your project folder</span></span>
<span id="cb32-11"><a></a><span class="fu">mkdir</span> mypythonlibrary</span>
<span id="cb32-12"><a></a><span class="bu">cd</span> mypythonlibrary</span>
<span id="cb32-13"><a></a></span>
<span id="cb32-14"><a></a><span class="co"># (Optional) Open the folder in VS Code</span></span>
<span id="cb32-15"><a></a><span class="ex">code</span> .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="hello-r-the-hello-world-slide" class="slide level2">
<h2>hello() (R: the “Hello, world!” slide)</h2>
<p><strong><code>pypkg/hello.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="kw">def</span> hello() <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-2"><a></a>    <span class="co">"""Return a friendly greeting."""</span></span>
<span id="cb33-3"><a></a>    <span class="cf">return</span> <span class="st">"Hello, world!"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong><code>pypkg/__init__.py</code></strong> — expose the public API (like exporting in NAMESPACE)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="im">from</span> .hello <span class="im">import</span> hello</span>
<span id="cb34-2"><a></a></span>
<span id="cb34-3"><a></a><span class="va">__all__</span> <span class="op">=</span> [<span class="st">"hello"</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="build-a-wheel-r-r-cmd-build" class="slide level2">
<h2>Build a wheel (R: <code>R CMD build</code>)</h2>
<p><strong><code>setup.py</code></strong> (simple &amp; minimal)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a><span class="im">from</span> setuptools <span class="im">import</span> setup, find_packages</span>
<span id="cb35-2"><a></a></span>
<span id="cb35-3"><a></a>setup(</span>
<span id="cb35-4"><a></a>    name<span class="op">=</span><span class="st">"pypkg"</span>,</span>
<span id="cb35-5"><a></a>    version<span class="op">=</span><span class="st">"0.1.0"</span>,</span>
<span id="cb35-6"><a></a>    description<span class="op">=</span><span class="st">"Tiny demo library"</span>,</span>
<span id="cb35-7"><a></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb35-8"><a></a>    packages<span class="op">=</span>find_packages(include<span class="op">=</span>[<span class="st">"pypkg"</span>, <span class="st">"pypkg.*"</span>]),</span>
<span id="cb35-9"><a></a>    install_requires<span class="op">=</span>[<span class="st">"numpy&gt;=1.26"</span>],</span>
<span id="cb35-10"><a></a>    python_requires<span class="op">=</span><span class="st">"&gt;=3.9"</span>,</span>
<span id="cb35-11"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Build:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a></a><span class="ex">python</span> setup.py bdist_wheel</span>
<span id="cb36-2"><a></a><span class="fu">ls</span> dist/</span>
<span id="cb36-3"><a></a><span class="co"># pypkg-0.1.0-py3-none-any.whl</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Install &amp; try:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a></a><span class="ex">pip</span> install dist/pypkg-0.1.0-py3-none-any.whl</span>
<span id="cb37-2"><a></a><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import pypkg; print(pypkg.hello())"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="dataset-snipes-r-datasnipes.rda-data-raw" class="slide level2">
<h2>Dataset: <strong>snipes</strong> (R: <code>data/snipes.rda</code> + data-raw)</h2>
<p><strong>Ship the CSV</strong> and provide a loader (no pandas required).</p>
<p><strong><code>pypkg/data.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a><span class="im">from</span> importlib <span class="im">import</span> resources</span>
<span id="cb38-2"><a></a><span class="im">import</span> csv, io</span>
<span id="cb38-3"><a></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb38-4"><a></a></span>
<span id="cb38-5"><a></a><span class="kw">def</span> load_snipes() <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, <span class="bu">str</span>]]:</span>
<span id="cb38-6"><a></a>    <span class="co">"""Load the bundled 'snipes' dataset (list of dict rows)."""</span></span>
<span id="cb38-7"><a></a>    <span class="cf">with</span> resources.files(<span class="st">"pypkg.data"</span>).joinpath(<span class="st">"snipes.csv"</span>).<span class="bu">open</span>(<span class="st">"rb"</span>) <span class="im">as</span> fh:</span>
<span id="cb38-8"><a></a>        text <span class="op">=</span> io.TextIOWrapper(fh, encoding<span class="op">=</span><span class="st">"utf-8"</span>)</span>
<span id="cb38-9"><a></a>        <span class="cf">return</span> <span class="bu">list</span>(csv.DictReader(text))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong><code>MANIFEST.in</code></strong> — include data in the wheel</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb39-1"><a></a>include pypkg/data/snipes.csv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote>
<p>R parallel: <code>use_data()</code> writes <code>data/*.rda</code>; here we ship a CSV + loader.</p>
</blockquote>
</section>
<section id="preserve-the-origin-story-r-data-raw" class="slide level2">
<h2>Preserve the origin story (R: <code>data-raw/</code>)</h2>
<p>Keep raw files &amp; scripts <strong>outside</strong> the wheel (tracked in Git):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb40-1"><a></a>data_raw/</span>
<span id="cb40-2"><a></a>  snipes_raw.csv</span>
<span id="cb40-3"><a></a>  make_snipes.py   # cleans raw → writes pypkg/data/snipes.csv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote>
<p>R parallel: <code>usethis::use_data_raw()</code> + <code>.Rbuildignore</code>; Py: keep <code>data_raw/</code> out of <code>MANIFEST.in</code>.</p>
</blockquote>
</section>
<section id="documenting-dataset-r-format-source" class="slide level2">
<h2>Documenting dataset (R: <span class="citation" data-cites="format">@format</span>, <span class="citation" data-cites="source">@source</span>)</h2>
<p>Use the loader’s <strong>docstring</strong>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a><span class="kw">def</span> load_snipes() <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, <span class="bu">str</span>]]:</span>
<span id="cb41-2"><a></a>    <span class="co">"""</span></span>
<span id="cb41-3"><a></a><span class="co">    Load the bundled 'snipes' dataset.</span></span>
<span id="cb41-4"><a></a></span>
<span id="cb41-5"><a></a><span class="co">    Fields</span></span>
<span id="cb41-6"><a></a><span class="co">    ------</span></span>
<span id="cb41-7"><a></a><span class="co">    discount : str</span></span>
<span id="cb41-8"><a></a><span class="co">    brand    : str</span></span>
<span id="cb41-9"><a></a><span class="co">    price    : str</span></span>
<span id="cb41-10"><a></a></span>
<span id="cb41-11"><a></a><span class="co">    Source</span></span>
<span id="cb41-12"><a></a><span class="co">    ------</span></span>
<span id="cb41-13"><a></a><span class="co">    https://www.snipes.ch/</span></span>
<span id="cb41-14"><a></a><span class="co">    """</span></span>
<span id="cb41-15"><a></a>    ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>MkDocs (later) will render this automatically.</p>
</section>
<section id="regression-coefficients-r-r-with-statslm" class="slide level2">
<h2>Regression coefficients (R: <code>%r%</code> with <code>stats::lm</code>)</h2>
<p>Implement a tiny OLS with <strong>NumPy</strong> (no heavy deps).</p>
<p><strong><code>pypkg/regression.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a></a><span class="im">from</span> typing <span class="im">import</span> Iterable, Tuple</span>
<span id="cb42-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb42-3"><a></a></span>
<span id="cb42-4"><a></a><span class="kw">def</span> reg_coef(y: Iterable[<span class="bu">float</span>], x: Iterable[<span class="bu">float</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">float</span>, <span class="bu">float</span>]:</span>
<span id="cb42-5"><a></a>    <span class="co">"""</span></span>
<span id="cb42-6"><a></a><span class="co">    Compute OLS coefficients for y ~ 1 + x.</span></span>
<span id="cb42-7"><a></a></span>
<span id="cb42-8"><a></a><span class="co">    Returns</span></span>
<span id="cb42-9"><a></a><span class="co">    -------</span></span>
<span id="cb42-10"><a></a><span class="co">    (intercept, slope)</span></span>
<span id="cb42-11"><a></a><span class="co">    """</span></span>
<span id="cb42-12"><a></a>    y <span class="op">=</span> np.asarray(y, dtype<span class="op">=</span><span class="bu">float</span>).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb42-13"><a></a>    x <span class="op">=</span> np.asarray(x, dtype<span class="op">=</span><span class="bu">float</span>).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb42-14"><a></a>    <span class="cf">if</span> y.shape[<span class="dv">0</span>] <span class="op">!=</span> x.shape[<span class="dv">0</span>]:</span>
<span id="cb42-15"><a></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"x and y must have the same length"</span>)</span>
<span id="cb42-16"><a></a>    X <span class="op">=</span> np.c_[np.ones_like(x), x]</span>
<span id="cb42-17"><a></a>    beta, <span class="op">*</span>_ <span class="op">=</span> np.linalg.lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb42-18"><a></a>    b0, b1 <span class="op">=</span> beta.ravel().tolist()</span>
<span id="cb42-19"><a></a>    <span class="cf">return</span> b0, b1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote>
<p>R parallel: returns <code>coef(lm(y ~ x))</code>.</p>
</blockquote>
</section>
<section id="example-script-r-instexampleseg_reg_coef.r" class="slide level2">
<h2>Example script (R: <code>inst/examples/eg_reg_coef.R</code>)</h2>
<p><strong><code>examples/eg_reg_coef.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a><span class="im">from</span> pypkg <span class="im">import</span> reg_coef</span>
<span id="cb43-2"><a></a></span>
<span id="cb43-3"><a></a>y <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>]</span>
<span id="cb43-4"><a></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb43-5"><a></a><span class="bu">print</span>(reg_coef(y, x))   <span class="co"># → (intercept, slope)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Run:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a></a><span class="ex">python</span> examples/eg_reg_coef.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="update-public-api-r-namespace" class="slide level2">
<h2>Update public API (R: NAMESPACE)</h2>
<p><strong><code>pypkg/__init__.py</code></strong> — expose the public API (like exporting in NAMESPACE)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a><span class="im">from</span> .hello <span class="im">import</span> hello</span>
<span id="cb45-2"><a></a><span class="im">from</span> .regression <span class="im">import</span> reg_coef</span>
<span id="cb45-3"><a></a><span class="im">from</span> .data <span class="im">import</span> load_snipes</span>
<span id="cb45-4"><a></a></span>
<span id="cb45-5"><a></a><span class="va">__all__</span> <span class="op">=</span> [<span class="st">"hello"</span>, <span class="st">"reg_coef"</span>, <span class="st">"load_snipes"</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="re-build-a-wheel-r-r-cmd-build" class="slide level2">
<h2>Re-Build a wheel (R: <code>R CMD build</code>)</h2>
<p><strong><code>setup.py</code></strong> (simple &amp; minimal)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a><span class="im">from</span> setuptools <span class="im">import</span> setup, find_packages</span>
<span id="cb46-2"><a></a></span>
<span id="cb46-3"><a></a>setup(</span>
<span id="cb46-4"><a></a>    name<span class="op">=</span><span class="st">"pypkg"</span>,</span>
<span id="cb46-5"><a></a>    version<span class="op">=</span><span class="st">"0.1.0"</span>,</span>
<span id="cb46-6"><a></a>    description<span class="op">=</span><span class="st">"Tiny demo library"</span>,</span>
<span id="cb46-7"><a></a>    author<span class="op">=</span><span class="st">"Your Name"</span>,</span>
<span id="cb46-8"><a></a>    packages<span class="op">=</span>find_packages(include<span class="op">=</span>[<span class="st">"pypkg"</span>, <span class="st">"pypkg.*"</span>]),</span>
<span id="cb46-9"><a></a>    install_requires<span class="op">=</span>[<span class="st">"numpy&gt;=1.26"</span>],</span>
<span id="cb46-10"><a></a>    include_package_data<span class="op">=</span><span class="va">True</span>,   <span class="co"># needed with MANIFEST.in</span></span>
<span id="cb46-11"><a></a>    python_requires<span class="op">=</span><span class="st">"&gt;=3.9"</span>,</span>
<span id="cb46-12"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Build:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a></a><span class="ex">python</span> setup.py bdist_wheel</span>
<span id="cb47-2"><a></a><span class="fu">ls</span> dist/</span>
<span id="cb47-3"><a></a><span class="co"># pypkg-0.1.0-py3-none-any.whl</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Install &amp; try:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a></a><span class="ex">pip</span> install dist/pypkg-0.1.0-py3-none-any.whl</span>
<span id="cb48-2"><a></a><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import pypkg; print(pypkg.hello()); print(pypkg.reg_coef([2,4,6,8],[1,2,3,4]))"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="tests-r-testthat" class="slide level2">
<h2>Tests (R: testthat)</h2>
<p>Install pytest (already done) and add three tests.</p>
<p><strong><code>tests/test_hello.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a><span class="im">from</span> pypkg <span class="im">import</span> hello</span>
<span id="cb49-2"><a></a><span class="kw">def</span> test_hello():</span>
<span id="cb49-3"><a></a>    <span class="cf">assert</span> hello() <span class="op">==</span> <span class="st">"Hello, world!"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong><code>tests/test_regression.py</code></strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a><span class="im">import</span> pytest</span>
<span id="cb50-2"><a></a><span class="im">from</span> pypkg <span class="im">import</span> reg_coef</span>
<span id="cb50-3"><a></a></span>
<span id="cb50-4"><a></a><span class="kw">def</span> test_reg_coef_values():</span>
<span id="cb50-5"><a></a>    y, x <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb50-6"><a></a>    b0, b1 <span class="op">=</span> reg_coef(y, x)</span>
<span id="cb50-7"><a></a>    <span class="cf">assert</span> <span class="bu">round</span>(b0, <span class="dv">6</span>) <span class="op">==</span> <span class="fl">0.0</span></span>
<span id="cb50-8"><a></a>    <span class="cf">assert</span> <span class="bu">round</span>(b1, <span class="dv">6</span>) <span class="op">==</span> <span class="fl">2.0</span></span>
<span id="cb50-9"><a></a></span>
<span id="cb50-10"><a></a><span class="kw">def</span> test_reg_coef_input_shape():</span>
<span id="cb50-11"><a></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb50-12"><a></a>        reg_coef([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Run:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a></a><span class="ex">pytest</span> <span class="at">-q</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="explicit-imports-r-importfrom-rule" class="slide level2">
<h2>“Explicit imports” (R: <code>@importFrom</code> rule)</h2>
<ul>
<li>In R, <strong>bare names</strong> require <code>@importFrom pkg fun</code>.</li>
<li>In Python, prefer <strong>explicit imports</strong> at the top:</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a></a><span class="co"># Good: explicit &amp; narrow</span></span>
<span id="cb52-2"><a></a><span class="im">from</span> numpy.linalg <span class="im">import</span> lstsq</span>
<span id="cb52-3"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb52-4"><a></a></span>
<span id="cb52-5"><a></a><span class="co"># Avoid: wildcard imports (hard to track &amp; test)</span></span>
<span id="cb52-6"><a></a><span class="im">from</span> numpy.linalg <span class="im">import</span> <span class="op">*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote>
<p>Clear imports → fewer undefined symbols, better tests &amp; CI.</p>
</blockquote>
</section>
<section id="ci-github-actions-lite-budget-friendly" class="slide level2">
<h2>CI (GitHub Actions) — lite &amp; budget-friendly</h2>
<p><code>.github/workflows/python-ci.yml</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb53-1"><a></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Python CI (lite)</span></span>
<span id="cb53-2"><a></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb53-3"><a></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb53-4"><a></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb53-5"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"pypkg/**"</span></span>
<span id="cb53-6"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"tests/**"</span></span>
<span id="cb53-7"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"setup.py"</span></span>
<span id="cb53-8"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"MANIFEST.in"</span></span>
<span id="cb53-9"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">".github/workflows/**"</span></span>
<span id="cb53-10"><a></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb53-11"><a></a></span>
<span id="cb53-12"><a></a><span class="fu">concurrency</span><span class="kw">:</span></span>
<span id="cb53-13"><a></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> ${{ github.workflow }}-${{ github.ref }}</span></span>
<span id="cb53-14"><a></a><span class="at">  </span><span class="fu">cancel-in-progress</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb53-15"><a></a></span>
<span id="cb53-16"><a></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb53-17"><a></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb53-18"><a></a><span class="at">    </span><span class="fu">if</span><span class="kw">:</span><span class="at"> </span><span class="st">"!contains(github.event.head_commit.message, '[skip ci]')"</span></span>
<span id="cb53-19"><a></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb53-20"><a></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb53-21"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb53-22"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v5</span></span>
<span id="cb53-23"><a></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.11"</span><span class="kw">,</span><span class="at"> </span><span class="fu">cache</span><span class="kw">:</span><span class="at"> </span><span class="st">"pip"</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb53-24"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python -m pip install -U pip</span></span>
<span id="cb53-25"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pip install -e . pytest</span></span>
<span id="cb53-26"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> pytest -q</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="docs-r-pkgdown-optional-but-nice" class="slide level2">
<h2>Docs (R: pkgdown) — optional but nice</h2>
<p><strong>1) Install</strong>: Add <strong>MkDocs</strong> later to auto-render docstrings:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a></a><span class="ex">pip</span> install mkdocs mkdocstrings<span class="pp">[</span><span class="ss">python</span><span class="pp">]</span> mkdocs-material</span>
<span id="cb54-2"><a></a><span class="ex">mkdocs</span> new .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>2) Configure</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb55-1"><a></a><span class="co"># mkdocs.yml</span></span>
<span id="cb55-2"><a></a><span class="fu">site_name</span><span class="kw">:</span><span class="at"> pypkg</span></span>
<span id="cb55-3"><a></a><span class="fu">theme</span><span class="kw">:</span><span class="at"> material</span></span>
<span id="cb55-4"><a></a><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb55-5"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">mkdocstrings</span><span class="kw">:</span></span>
<span id="cb55-6"><a></a><span class="at">      </span><span class="fu">handlers</span><span class="kw">:</span></span>
<span id="cb55-7"><a></a><span class="at">        </span><span class="fu">python</span><span class="kw">:</span></span>
<span id="cb55-8"><a></a><span class="at">          </span><span class="fu">options</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">docstring_style</span><span class="kw">:</span><span class="at"> numpy</span><span class="kw">,</span><span class="at"> </span><span class="fu">show_source</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb55-9"><a></a><span class="fu">nav</span><span class="kw">:</span></span>
<span id="cb55-10"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">Home</span><span class="kw">:</span><span class="at"> index.md</span></span>
<span id="cb55-11"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">API</span><span class="kw">:</span><span class="at"> api.md</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="docs" class="slide level2">
<h2>Docs</h2>
<p><strong>3) Write docs</strong></p>
<p>Create <code>docs/index.md</code> (overview/quickstart) and <code>docs/api.md</code> for the API.</p>
<p><strong>docs/index.md (example)</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb56-1"><a></a><span class="fu"># pypkg</span></span>
<span id="cb56-2"><a></a></span>
<span id="cb56-3"><a></a>A tiny library with <span class="in">`hello()`</span>, <span class="in">`reg_coef()`</span>, and the <span class="in">`snipes`</span> dataset loader.</span>
<span id="cb56-4"><a></a></span>
<span id="cb56-5"><a></a><span class="fu">## Quickstart</span></span>
<span id="cb56-6"><a></a><span class="in">```bash</span></span>
<span id="cb56-7"><a></a><span class="ex">pip</span> install <span class="at">-e</span> .</span>
<span id="cb56-8"><a></a><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import pypkg; print(pypkg.hello())"</span></span>
<span id="cb56-9"><a></a><span class="in">```</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>docs/api.md (auto API from docstrings)</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a></a><span class="fu"># API Reference</span></span>
<span id="cb57-2"><a></a></span>
<span id="cb57-3"><a></a>::: pypkg</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>4) Preview &amp; build</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a></a><span class="ex">mkdocs</span> serve     <span class="co"># local preview</span></span>
<span id="cb58-2"><a></a><span class="ex">mkdocs</span> build     <span class="co"># outputs site/</span></span>
<span id="cb58-3"><a></a><span class="ex">mkdocs</span> gh-deploy <span class="co"># (optional) deploy to GitHub Pages</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="release-semver-same-rule-as-r-slides" class="slide level2">
<h2>Release &amp; SemVer (same rule as R slides)</h2>
<ul>
<li><code>0.1.0</code> → new features: <strong>MINOR</strong>; bugfix: <strong>PATCH</strong>; breaking: <strong>MAJOR</strong>.</li>
<li>Tag: <code>git tag v0.1.0 &amp;&amp; git push --tags</code></li>
<li>Build wheel, test in a fresh venv, then (optionally) <strong>TestPyPI → PyPI</strong> with <code>twine</code>.</li>
</ul>
</section>
<section id="install-from-github" class="slide level2">
<h2>Install from GitHub</h2>
<p><strong>For users (install from GitHub):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a></a><span class="co"># Option 1: Using pip and remotes (recommended)</span></span>
<span id="cb59-2"><a></a><span class="ex">pip</span> install git+https://github.com/your-org/yourpkg@v0.1.0</span>
<span id="cb59-3"><a></a></span>
<span id="cb59-4"><a></a><span class="co"># Option 2: Using `pip install -e .` for editable installs (locally cloned repo)</span></span>
<span id="cb59-5"><a></a><span class="fu">git</span> clone https://github.com/your-org/yourpkg</span>
<span id="cb59-6"><a></a><span class="bu">cd</span> yourpkg</span>
<span id="cb59-7"><a></a><span class="ex">pip</span> install <span class="at">-e</span> .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="quick-recap-r-py" class="slide level2">
<h2>Quick recap (R ↔︎ Py)</h2>
<ul>
<li><strong>hello()</strong> → printed message ⟷ returns/prints in Python.</li>
<li><strong>snipes dataset</strong> → <code>load_snipes()</code> with packaged CSV.</li>
<li><strong>regression coefficients</strong> → <code>reg_coef()</code> via NumPy OLS.</li>
<li><strong>examples</strong> → <code>examples/eg_reg_coef.py</code> (like <code>inst/examples</code>).</li>
<li><strong>tests</strong> → <code>pytest</code> (like <code>testthat</code>).</li>
<li><strong>CI</strong> → Actions (lite).</li>
<li><strong>docs/release</strong> → optional MkDocs, SemVer tags + wheel upload.</li>
</ul>
</section>
<section id="when-should-you-create-a-library" class="slide level2">
<h2>When should you create a library?</h2>
<ul>
<li><strong>Rule of Three:</strong> you’ve copied the same functions across <strong>≥ 3 projects</strong>.</li>
<li><strong>Audience &gt; you:</strong> teammates/students need to reuse your code.</li>
<li><strong>Stable core idea:</strong> function names/arguments won’t change every week.</li>
<li><strong>Testing matters:</strong> you’re willing to add <strong>automated tests</strong> (testthat/pytest).</li>
<li><strong>Versioning matters:</strong> you want <strong>SemVer</strong> to communicate changes.</li>
<li><strong>Docs exist:</strong> you can write a <strong>README</strong> and minimal usage examples (vignette/doc page).</li>
<li><strong>Multiple environments:</strong> others will run it on different machines/OS.</li>
</ul>
</section>
<section id="when-not-yet" class="slide level2">
<h2>When <em>not</em> (yet)</h2>
<ul>
<li><strong>One-off notebook/report:</strong> no planned reuse.</li>
<li><strong>Spike/prototype:</strong> API and data shapes still change daily.</li>
<li><strong>Entangled secrets/paths:</strong> credentials or local file paths mixed with logic.</li>
<li><strong>Huge assets:</strong> gigabytes of data/binaries—ship loaders, not raw assets.</li>
<li><strong>No maintainer bandwidth:</strong> can’t commit to fixes/docs/release bumps.</li>
</ul>
<blockquote>
<p>Heuristic: if you’d hesitate to fix a bug reported by someone else, don’t package yet.</p>
</blockquote>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="object-oriented-programming" class="title-slide slide level1 center">
<h1>Object-Oriented Programming</h1>

</section>
<section id="why-oop" class="slide level2">
<h2>Why OOP?</h2>
<div class="columns">
<div class="column">
<ul>
<li><strong>Tame complexity.</strong> Large codebases drift into <em>“spaghetti code”</em> when everything touches everything. OOP groups data + behavior into <strong>cohesive modules</strong> (classes) with clear <strong>interfaces</strong>.</li>
<li><strong>Reuse &amp; extension.</strong> Add new features by creating new classes or methods—<strong>without</strong> rewriting callers (polymorphism).</li>
<li><strong>Safer changes.</strong> Internals can evolve behind the interface (encapsulation), reducing ripple effects and regressions.</li>
</ul>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><strong>Context:</strong> The “spaghetti code” idea is often cited in post-mortems of complex systems (e.g., discussions around large automotive software stacks). Clear module boundaries and interfaces are a first line of defense, (see <a href="https://users.ece.cmu.edu/~koopman/pubs/koopman14_toyota_ua_slides.pdf">Toyota 2013 case study</a>)</p>
</div>
</div>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/spaghetti-vs-modules.png" class="quarto-figure quarto-figure-center" width="560"></p>
</figure>
</div>
</div></div>
</section>
<section id="part-i-r-functions-s3-oop" class="slide level2">
<h2>Part I — R Functions &amp; S3 OOP</h2>
</section>
<section id="function" class="slide level2">
<h2>Function</h2>
<p><img data-src="images/lego-674354_1280.jpg" class="quarto-figure quarto-figure-center" width="600" height="400"> <!-- LEGO = functions as small reusable building blocks --></p>
</section>
<section id="everything-is-a-function-call" class="slide level2">
<h2>“Everything is a function call”</h2>
<ul>
<li>A function has three components: <strong>arguments</strong>, a <strong>body</strong>, and an <strong>environment</strong>.</li>
<li>Signalling conditions: <strong>errors</strong> (severe), <strong>warnings</strong> (mild), <strong>messages</strong> (informative).</li>
<li>Lexical scoping: dynamic lookup &amp; name masking.</li>
<li>Environments: <strong>current</strong>, <strong>global</strong>, <strong>empty</strong>, <strong>execution</strong>, <strong>package</strong>.</li>
<li>Composition via <strong>nesting</strong> or <strong>piping</strong> (<code>|&gt;</code>).</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a><span class="co"># A function is an object</span></span>
<span id="cb60-2"><a></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb60-3"><a></a><span class="fu">typeof</span>(f); <span class="fu">formals</span>(f); <span class="fu">environment</span>(f)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="signalling-conditions" class="slide level2">
<h2>Signalling conditions</h2>

<!-- Traffic lights: red=error, yellow=warning, green=message -->
<img data-src="images/traffic-lights.jpg" class="quarto-figure quarto-figure-center r-stretch" width="520"><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a><span class="fu">message</span>(<span class="st">"This is a friendly message"</span>)</span>
<span id="cb61-2"><a></a><span class="fu">warning</span>(<span class="st">"This is a mild warning"</span>)</span>
<span id="cb61-3"><a></a><span class="fu">try</span>(<span class="fu">stop</span>(<span class="st">"This is an error"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in try(stop("This is an error")) : This is an error</code></pre>
</div>
</div>
</section>
<section id="lexical-scoping" class="slide level2">
<h2>Lexical scoping</h2>

<!-- Matryoshka: nested scopes -->
<img data-src="images/matryoshka-scope.jpg" class="quarto-figure quarto-figure-center r-stretch" width="450"><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb63-2"><a></a>outer <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb63-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb63-4"><a></a>  inner <span class="ot">&lt;-</span> <span class="cf">function</span>() x</span>
<span id="cb63-5"><a></a>  <span class="fu">inner</span>()</span>
<span id="cb63-6"><a></a>}</span>
<span id="cb63-7"><a></a><span class="fu">outer</span>()  <span class="co"># 5: name masking</span></span>
<span id="cb63-8"><a></a>x        <span class="co"># 10: global unchanged</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="s3-oop-system" class="slide level2">
<h2>S3 OOP system</h2>
<ul>
<li>Object-oriented programming (OOP) is a popular programming paradigm.</li>
<li>The type of an object is a <strong>class</strong> and a function implemented for a specific class is a <strong>method</strong>.</li>
<li><strong>Polymorphism</strong>: function interface is separated from its implementation; behavior depends on class.</li>
<li><strong>Encapsulation</strong>: object interface is separated from its internal structure; users don’t need to worry about details. Encapsulation helps avoid spaghetti code.</li>
<li><code>R</code> has several OOP systems: S3, S4, R6, …</li>
<li>S3 is the first R OOP system; it is informal (easy to modify) and widespread.</li>
</ul>
</section>
<section id="minimal-s3-example" class="slide level2">
<h2>Minimal S3 example</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a><span class="co"># Minimal S3 example: generic + methods</span></span>
<span id="cb64-2"><a></a>area <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) <span class="fu">UseMethod</span>(<span class="st">"area"</span>)        <span class="co"># generic</span></span>
<span id="cb64-3"><a></a></span>
<span id="cb64-4"><a></a><span class="co"># constructor for a 'circle'</span></span>
<span id="cb64-5"><a></a>new_circle <span class="ot">&lt;-</span> <span class="cf">function</span>(radius) <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">radius =</span> radius), <span class="at">class =</span> <span class="st">"circle"</span>)</span>
<span id="cb64-6"><a></a>area.circle <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) pi <span class="sc">*</span> x<span class="sc">$</span>radius<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb64-7"><a></a></span>
<span id="cb64-8"><a></a><span class="co"># constructor for a 'rectangle'</span></span>
<span id="cb64-9"><a></a>new_rectangle <span class="ot">&lt;-</span> <span class="cf">function</span>(w, h) <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">w =</span> w, <span class="at">h =</span> h), <span class="at">class =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb64-10"><a></a>area.rectangle <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) x<span class="sc">$</span>w <span class="sc">*</span> x<span class="sc">$</span>h</span>
<span id="cb64-11"><a></a></span>
<span id="cb64-12"><a></a>c1 <span class="ot">&lt;-</span> <span class="fu">new_circle</span>(<span class="dv">2</span>)</span>
<span id="cb64-13"><a></a>r1 <span class="ot">&lt;-</span> <span class="fu">new_rectangle</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb64-14"><a></a><span class="fu">area</span>(c1); <span class="fu">area</span>(r1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="why-oop-1" class="slide level2">
<h2>Why OOP?</h2>

<!-- One remote, many devices = one function name, many behaviors -->
<img data-src="images/one-remote-many-devices.jpg" class="quarto-figure quarto-figure-center r-stretch" width="560"><ul>
<li><strong>Uniform interfaces</strong>: one verb (e.g., <code>summary()</code>, <code>plot()</code>) works across many data types.</li>
<li><strong>Separation of concerns</strong>: analyses call verbs; classes handle <strong>how</strong>.</li>
<li><strong>Extensibility</strong>: you can add behavior for <strong>new data types</strong> without touching old code.</li>
<li><strong>Safer refactoring</strong>: callers don’t change; class-specific methods evolve independently.</li>
<li><strong>Discoverability</strong>: “What happens if I call <code>summary()</code> on this object?” → predictable, documented.</li>
</ul>
<blockquote>
<p>In R, this is powered by <strong>S3</strong>: a lightweight dispatch system that maps a <strong>generic</strong> (like <code>summary</code>) to a <strong>method</strong> (like <code>summary.lm</code>) based on the object’s class.</p>
</blockquote>
</section>
<section id="s3-oop-motivation" class="slide level2">
<h2>S3 OOP — Motivation</h2>
<ul>
<li><strong>Polymorphism</strong>: same function name, different behavior by object <strong>class</strong>.</li>
<li><strong>Lightweight encapsulation</strong>: use interfaces, not internals.</li>
<li><strong>Informal &amp; flexible</strong> (no strict class declarations).</li>
</ul>

<!-- Toolbox: same tool name adapts to material -->
<img data-src="images/toolbox-polymorphism.jpg" class="quarto-figure quarto-figure-center r-stretch" width="540"></section>
<section id="polymorphism-example" class="slide level2">
<h2>Polymorphism example</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a><span class="fu">summary</span>(cars<span class="sc">$</span>speed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    4.0    12.0    15.0    15.4    19.0    25.0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a><span class="fu">summary</span>(<span class="fu">lm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = cars$speed ~ cars$dist)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5293 -2.1550  0.3615  2.4377  6.4179 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  8.28391    0.87438   9.474 1.44e-12 ***
cars$dist    0.16557    0.01749   9.464 1.49e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.156 on 48 degrees of freedom
Multiple R-squared:  0.6511,    Adjusted R-squared:  0.6438 
F-statistic: 89.57 on 1 and 48 DF,  p-value: 1.49e-12</code></pre>
</div>
</div>
</section>
<section id="what-is-happening-dispatch" class="slide level2">
<h2>What is happening? (dispatch)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">summary</span>(cars<span class="sc">$</span>speed))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   summary.double
   summary.numeric
=&gt; summary.default</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">summary</span>(<span class="fu">lm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=&gt; summary.lm
 * summary.default</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a></a><span class="fu">class</span>(cars<span class="sc">$</span>speed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a></a><span class="fu">class</span>(<span class="fu">lm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lm"</code></pre>
</div>
</div>
<ul>
<li><code>*</code> method exists; <code>=&gt;</code> method selected.</li>
</ul>
</section>
<section id="peeking-at-generics-r" class="slide level2">
<h2>Peeking at generics (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a></a>summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (object, ...) 
UseMethod("summary")
&lt;bytecode: 0x5568d595b0c8&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a></a><span class="fu">head</span>(summary.default)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    
1 function (object, ..., digits, quantile.type = 7) 
2 {                                                 
3     if (is.factor(object))                        
4         return(summary.factor(object, ...))       
5     else if (is.matrix(object)) {                 
6         if (missing(digits))                      </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a></a><span class="fu">head</span>(summary.lm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                               
1 function (object, correlation = FALSE, symbolic.cor = FALSE, 
2     ...)                                                     
3 {                                                            
4     z &lt;- object                                              
5     p &lt;- z$rank                                              
6     rdf &lt;- z$df.residual                                     </code></pre>
</div>
</div>
</section>
<section id="forwarding-extra-arguments" class="slide level2">
<h2><code>...</code> — forwarding extra arguments</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...){ <span class="fu">list</span>(...) }</span>
<span id="cb83-2"><a></a><span class="fu">f</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] 1

$b
[1] 2</code></pre>
</div>
</div>
<ul>
<li>Useful for <strong>generics</strong> and <strong>passing options forward</strong>.</li>
</ul>
</section>
<section id="write-a-generic-methods-r-s3" class="slide level2">
<h2>Write a generic + methods (R, S3)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a></a>my_new_generic <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb85-2"><a></a>  <span class="fu">UseMethod</span>(<span class="st">"my_new_generic"</span>)</span>
<span id="cb85-3"><a></a>}</span>
<span id="cb85-4"><a></a></span>
<span id="cb85-5"><a></a>my_new_generic.default <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb85-6"><a></a>  <span class="st">"this is default method"</span></span>
<span id="cb85-7"><a></a>}</span>
<span id="cb85-8"><a></a></span>
<span id="cb85-9"><a></a>my_new_generic.lm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb85-10"><a></a>  <span class="st">"this is method for class `lm`"</span></span>
<span id="cb85-11"><a></a>}</span>
<span id="cb85-12"><a></a></span>
<span id="cb85-13"><a></a><span class="fu">my_new_generic</span>(cars<span class="sc">$</span>speed)</span>
<span id="cb85-14"><a></a><span class="fu">my_new_generic</span>(<span class="fu">lm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="check-the-dispatch-implicit-class" class="slide level2">
<h2>Check the dispatch &amp; implicit class</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">my_new_generic</span>(cars<span class="sc">$</span>speed))</span>
<span id="cb86-2"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">my_new_generic</span>(<span class="fu">lm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist)))</span>
<span id="cb86-3"><a></a>sloop<span class="sc">::</span><span class="fu">s3_class</span>(cars<span class="sc">$</span>speed)  <span class="co"># implicit "double"</span></span>
<span id="cb86-4"><a></a><span class="fu">typeof</span>(cars<span class="sc">$</span>speed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="inheritance-multiple-classes" class="slide level2">
<h2>Inheritance (multiple classes)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a></a><span class="fu">class</span>(<span class="fu">glm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>speed))</span>
<span id="cb87-2"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">summary</span>(<span class="fu">glm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist)))</span>
<span id="cb87-3"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">plot</span>(<span class="fu">glm</span>(cars<span class="sc">$</span>speed <span class="sc">~</span> cars<span class="sc">$</span>dist)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote>
<p>If a method isn’t found for the 1st class, R tries the next, and so on.</p>
</blockquote>
</section>
<section id="create-your-own-s3-class-quick-way" class="slide level2">
<h2>Create your own S3 class (quick way)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb88-2"><a></a>image <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">2</span>), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb88-3"><a></a><span class="fu">class</span>(image) <span class="ot">&lt;-</span> <span class="st">"pixel"</span></span>
<span id="cb88-4"><a></a><span class="fu">attributes</span>(image)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="create-your-own-s3-class-neater" class="slide level2">
<h2>Create your own S3 class (neater)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb89-2"><a></a>image <span class="ot">&lt;-</span> <span class="fu">structure</span>(</span>
<span id="cb89-3"><a></a>  <span class="fu">matrix</span>(<span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">2</span>), <span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb89-4"><a></a>  <span class="at">class =</span> <span class="st">"pixel"</span></span>
<span id="cb89-5"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a></a><span class="fu">plot</span>(image)  <span class="co"># No plot() method yet for class 'pixel'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="lecture04_files/figure-revealjs/unnamed-chunk-63-1.png" class="quarto-figure quarto-figure-center r-stretch" width="384"></section>
<section id="create-your-own-s3-class-with-a-constructor" class="slide level2">
<h2>Create your own S3 class with a constructor</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a></a><span class="co"># define a constructor for the 'pixel' class</span></span>
<span id="cb91-2"><a></a>new_pixel <span class="ot">&lt;-</span> <span class="cf">function</span>(mat) <span class="fu">structure</span>(mat, <span class="at">class =</span> <span class="st">"pixel"</span>)</span>
<span id="cb91-3"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb91-4"><a></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">2</span>), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb91-5"><a></a>image <span class="ot">&lt;-</span> <span class="fu">new_pixel</span>(mat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Caution</strong></p>
</div>
<div class="callout-content">
<p>How can we make this constructor more robust?</p>
</div>
</div>
</div>
</section>
<section id="validators" class="slide level2">
<h2>Validators</h2>
<ul>
<li>More complicated class require more complicated checks for validity.</li>
<li>Rather than making constructor complicated, we can define a <strong>validator</strong> function for the checks.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a></a><span class="co"># validator: enforce invariants</span></span>
<span id="cb92-2"><a></a>validate_pixel <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb92-3"><a></a>  mat <span class="ot">&lt;-</span> <span class="fu">unclass</span>(x)</span>
<span id="cb92-4"><a></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(mat) <span class="sc">||</span>  <span class="sc">!</span><span class="fu">is.numeric</span>(mat)) {</span>
<span id="cb92-5"><a></a>    <span class="fu">stop</span>(<span class="st">"A 'pixel' object must be a numeric matrix"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb92-6"><a></a>  }</span>
<span id="cb92-7"><a></a>  x</span>
<span id="cb92-8"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="extending-an-existing-generic-with-care" class="slide level2">
<h2>Extending an existing generic (with care)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a></a>plot.pixel <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb93-2"><a></a>  <span class="fu">heatmap</span>(x, ...)</span>
<span id="cb93-3"><a></a>}</span>
<span id="cb93-4"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">plot</span>(image))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=&gt; plot.pixel
 * plot.default</code></pre>
</div>
</div>
</section>
<section id="new-plot-for-class-pixel" class="slide level2">
<h2>New plot for class <code>pixel</code></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a></a><span class="fu">plot</span>(image)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="lecture04_files/figure-revealjs/unnamed-chunk-67-1.png" class="quarto-figure quarto-figure-center r-stretch" width="576"></section>
<section id="forwarding-extra-options-with-..." class="slide level2">
<h2>Forwarding extra options with <code>...</code></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a></a><span class="fu">plot</span>(image, <span class="at">col =</span> <span class="fu">cm.colors</span>(<span class="dv">256</span>), <span class="at">xlab =</span> <span class="st">"x axis"</span>, <span class="at">ylab =</span> <span class="st">"y axis"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="lecture04_files/figure-revealjs/unnamed-chunk-68-1.png" class="quarto-figure quarto-figure-center r-stretch" width="576"></section>
<section id="to-go-further-r" class="slide level2">
<h2>To go further (R)</h2>
<ul>
<li><em>An Introduction to Statistical Programming Methods with R</em> — Functions.</li>
<li><em>Advanced R</em> (Hadley Wickham), Ch. 6–8 (functions), 12–16 (OOP: S3, S4, R6).</li>
</ul>
</section>
<section id="part-ii-python-oop" class="slide level2">
<h2>Part II — Python OOP</h2>
</section>
<section id="why-oop-in-python" class="slide level2">
<h2>Why OOP in Python?</h2>

<!-- Blueprint (class) vs house (instance) -->
<img data-src="images/blueprint-house.jpg" class="quarto-figure quarto-figure-center r-stretch" width="560"><ul>
<li><strong>Class-based OOP</strong>: define <strong>classes</strong> (blueprints) and create <strong>instances</strong> (houses).</li>
<li><strong>Encapsulation</strong>: group data (<strong>attributes</strong>) with behavior (<strong>methods</strong>).</li>
<li><strong>Inheritance</strong>: share and extend behavior (code reuse).</li>
<li><strong>Polymorphism</strong>: same method name, different behaviors across types.</li>
<li><strong>Generic functions</strong> with <code>@singledispatch</code> provide an R-S3-like feel when helpful.</li>
</ul>
</section>
<section id="classes-instances" class="slide level2">
<h2>Classes &amp; instances</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a></a><span class="kw">class</span> Dog:</span>
<span id="cb97-2"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</span>
<span id="cb97-3"><a></a>        <span class="va">self</span>.name <span class="op">=</span> name      <span class="co"># attribute</span></span>
<span id="cb97-4"><a></a>    <span class="kw">def</span> speak(<span class="va">self</span>):          <span class="co"># method</span></span>
<span id="cb97-5"><a></a>        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss"> says woof!"</span></span>
<span id="cb97-6"><a></a></span>
<span id="cb97-7"><a></a>d <span class="op">=</span> Dog(<span class="st">"Milo"</span>)</span>
<span id="cb97-8"><a></a>d.speak()</span>
<span id="cb97-9"><a></a><span class="bu">type</span>(d), <span class="bu">isinstance</span>(d, Dog)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>class</code> defines a new type.</li>
<li><code>__init__</code> is the constructor (like R’s <code>new_*()</code>).</li>
<li><code>self</code> is the instance being operated on. It’s just a naming convention (not a keyword), but always the first parameter of instance methods.</li>
</ul>
</section>
<section id="encapsulation-group-data-behavior" class="slide level2">
<h2>Encapsulation (group data + behavior)</h2>

<img data-src="images/capsule-encapsulation.jpg" class="quarto-figure quarto-figure-center r-stretch" width="520"><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a></a><span class="kw">class</span> Counter:</span>
<span id="cb98-2"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, start<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb98-3"><a></a>        <span class="va">self</span>._value <span class="op">=</span> start   <span class="co"># underscore = “internal by convention”</span></span>
<span id="cb98-4"><a></a>    <span class="kw">def</span> inc(<span class="va">self</span>, step<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb98-5"><a></a>        <span class="va">self</span>._value <span class="op">+=</span> step</span>
<span id="cb98-6"><a></a>    <span class="kw">def</span> value(<span class="va">self</span>):</span>
<span id="cb98-7"><a></a>        <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb98-8"><a></a></span>
<span id="cb98-9"><a></a>c <span class="op">=</span> Counter()<span class="op">;</span> c.inc()<span class="op">;</span> c.value()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="inheritance-overriding" class="slide level2">
<h2>Inheritance &amp; overriding</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a></a><span class="kw">class</span> Animal:</span>
<span id="cb99-2"><a></a>    <span class="kw">def</span> speak(<span class="va">self</span>): <span class="cf">return</span> <span class="st">"..."</span></span>
<span id="cb99-3"><a></a></span>
<span id="cb99-4"><a></a><span class="kw">class</span> Dog(Animal):</span>
<span id="cb99-5"><a></a>    <span class="kw">def</span> speak(<span class="va">self</span>): <span class="cf">return</span> <span class="st">"woof"</span></span>
<span id="cb99-6"><a></a></span>
<span id="cb99-7"><a></a><span class="kw">class</span> Cat(Animal):</span>
<span id="cb99-8"><a></a>    <span class="kw">def</span> speak(<span class="va">self</span>): <span class="cf">return</span> <span class="st">"meow"</span></span>
<span id="cb99-9"><a></a></span>
<span id="cb99-10"><a></a>pets <span class="op">=</span> [Dog(), Cat(), Animal()]</span>
<span id="cb99-11"><a></a>[s.speak() <span class="cf">for</span> s <span class="kw">in</span> pets]     <span class="co"># polymorphism</span></span>
<span id="cb99-12"><a></a>Dog.__mro__                   <span class="co"># method resolution order</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="polymorphism-same-message-different-response" class="slide level2">
<h2>Polymorphism (same message, different response)</h2>

<img data-src="images/one-remote-many-devices.jpg" class="quarto-figure quarto-figure-center r-stretch" width="560"><div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a></a><span class="kw">def</span> make_it_speak(animal):</span>
<span id="cb100-2"><a></a>    <span class="bu">print</span>(animal.speak())</span>
<span id="cb100-3"><a></a></span>
<span id="cb100-4"><a></a><span class="cf">for</span> a <span class="kw">in</span> [Dog(), Cat()]:</span>
<span id="cb100-5"><a></a>    make_it_speak(a)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="generic-functions-with-singledispatch" class="slide level2">
<h2>Generic functions with <code>@singledispatch</code></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a></a><span class="im">from</span> functools <span class="im">import</span> singledispatch</span>
<span id="cb101-2"><a></a><span class="im">import</span> statistics <span class="im">as</span> stats</span>
<span id="cb101-3"><a></a></span>
<span id="cb101-4"><a></a><span class="at">@singledispatch</span></span>
<span id="cb101-5"><a></a><span class="kw">def</span> describe(x):</span>
<span id="cb101-6"><a></a>    <span class="cf">return</span> <span class="ss">f"Generic object of type </span><span class="sc">{</span><span class="bu">type</span>(x)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb101-7"><a></a></span>
<span id="cb101-8"><a></a><span class="at">@describe.register</span>(<span class="bu">list</span>)</span>
<span id="cb101-9"><a></a><span class="kw">def</span> _(x: <span class="bu">list</span>):</span>
<span id="cb101-10"><a></a>    <span class="cf">return</span> {<span class="st">"len"</span>: <span class="bu">len</span>(x), <span class="st">"mean"</span>: stats.mean(x)}</span>
<span id="cb101-11"><a></a></span>
<span id="cb101-12"><a></a><span class="kw">class</span> LinReg:</span>
<span id="cb101-13"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, coef, intercept): <span class="va">self</span>.coef, <span class="va">self</span>.intercept <span class="op">=</span> coef, intercept</span>
<span id="cb101-14"><a></a></span>
<span id="cb101-15"><a></a><span class="at">@describe.register</span>(LinReg)</span>
<span id="cb101-16"><a></a><span class="kw">def</span> _(m: LinReg):</span>
<span id="cb101-17"><a></a>    <span class="cf">return</span> {<span class="st">"coef"</span>: m.coef, <span class="st">"intercept"</span>: m.intercept}</span>
<span id="cb101-18"><a></a></span>
<span id="cb101-19"><a></a>describe([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), describe(LinReg([<span class="fl">0.5</span>], <span class="fl">2.0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Rule of thumb in Python:</p>
<ul>
<li><p>Use class methods when you control the class design.</p></li>
<li><p>Use <code>@singledispatch</code> when you want an external, pluggable generic (like S3) that different modules can extend without modifying the original class.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="composition-duck-typing" class="slide level2">
<h2>Composition &amp; duck typing</h2>
<ul>
<li>Interfaces by <strong>behavior</strong>: “if it quacks like a duck…”</li>
<li>Prefer composition when inheritance isn’t needed.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a></a><span class="kw">class</span> JsonWriter:</span>
<span id="cb102-2"><a></a>    <span class="kw">def</span> write(<span class="va">self</span>, obj): </span>
<span id="cb102-3"><a></a>        <span class="im">import</span> json<span class="op">;</span> <span class="cf">return</span> json.dumps(obj)</span>
<span id="cb102-4"><a></a></span>
<span id="cb102-5"><a></a><span class="kw">class</span> XmlWriter:</span>
<span id="cb102-6"><a></a>    <span class="kw">def</span> write(<span class="va">self</span>, obj):</span>
<span id="cb102-7"><a></a>        <span class="cf">return</span> <span class="st">"&lt;root&gt;...&lt;/root&gt;"</span></span>
<span id="cb102-8"><a></a></span>
<span id="cb102-9"><a></a><span class="kw">def</span> save(writer, obj):     <span class="co"># any object with .write() works</span></span>
<span id="cb102-10"><a></a>    <span class="cf">return</span> writer.write(obj)</span>
<span id="cb102-11"><a></a></span>
<span id="cb102-12"><a></a>save(JsonWriter(), {<span class="st">"a"</span>:<span class="dv">1</span>})</span>
<span id="cb102-13"><a></a>save(XmlWriter(), {<span class="st">"a"</span>:<span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>save</code> doesn’t care what the writer is—only that it has <code>.write()</code>.<br>
</li>
<li>You can plug in a new writer (CSV, YAML, DB, HTTP…) without touching save.</li>
</ul>
<blockquote>
<p>Pass in behavior (composition), don’t inherit it, when all you need is a capability.</p>
</blockquote>
</section>
<section id="a-tiny-generic-plot-analogy-to-rs-plot" class="slide level2">
<h2>A tiny “generic plot” (analogy to R’s <code>plot()</code>)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np, matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb103-2"><a></a><span class="im">from</span> functools <span class="im">import</span> singledispatch</span>
<span id="cb103-3"><a></a></span>
<span id="cb103-4"><a></a><span class="kw">class</span> Pixel:</span>
<span id="cb103-5"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data): <span class="va">self</span>.data <span class="op">=</span> np.array(data)</span>
<span id="cb103-6"><a></a></span>
<span id="cb103-7"><a></a><span class="at">@singledispatch</span></span>
<span id="cb103-8"><a></a><span class="kw">def</span> plot(obj): </span>
<span id="cb103-9"><a></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f"Don't know how to plot </span><span class="sc">{</span><span class="bu">type</span>(obj)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-10"><a></a></span>
<span id="cb103-11"><a></a><span class="at">@plot.register</span></span>
<span id="cb103-12"><a></a><span class="kw">def</span> _(obj: Pixel):</span>
<span id="cb103-13"><a></a>    plt.imshow(obj.data)<span class="op">;</span> plt.title(<span class="st">"Pixel"</span>)<span class="op">;</span> plt.show()</span>
<span id="cb103-14"><a></a></span>
<span id="cb103-15"><a></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">123</span>)</span>
<span id="cb103-16"><a></a>image <span class="op">=</span> rng.gamma(shape<span class="op">=</span><span class="fl">2.0</span>, scale<span class="op">=</span><span class="fl">1.0</span>, size<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb103-17"><a></a>px <span class="op">=</span> Pixel(image)</span>
<span id="cb103-18"><a></a>plot(px)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="to-go-further-python" class="slide level2">
<h2>To go further (Python)</h2>
<ul>
<li>Python tutorial on <strong>classes</strong> (docs.python.org)</li>
<li><code>functools.singledispatch</code> for generic functions</li>
<li><code>inspect</code> for introspection, <code>abc</code> for abstract base classes</li>
</ul>
</section>
<section id="bridges-r-s3-python-oop" class="slide level2">
<h2>Bridges — R S3 ↔︎ Python OOP</h2>

<img data-src="images/bridge-r-python.jpg" class="quarto-figure quarto-figure-center r-stretch" width="560"><ul>
<li><p><strong>Generic function</strong></p>
<ul>
<li>R: <code>summary(x)</code> → <code>summary.&lt;class&gt;</code> via <strong>S3 dispatch</strong>.</li>
<li>Python: <code>@singledispatch</code> picks implementation by <strong>type</strong>.</li>
</ul></li>
<li><p><strong>Class identity</strong></p>
<ul>
<li>R S3: <code>class(x)</code> is an attribute; can be a vector (ordered inheritance).</li>
<li>Python: <code>type(x)</code> is the class; inheritance via <strong>MRO</strong> chain.</li>
</ul></li>
<li><p><strong>Extensibility</strong></p>
<ul>
<li>R: add <code>generic.class &lt;- function(x, ...) {}</code> for known generics (mind <code>...</code>).</li>
<li>Python: <code>@generic.register(Type)</code> or subclass and override methods.</li>
</ul></li>
<li><p><strong>Scoping / environments vs namespaces</strong></p>
<ul>
<li>R: function environments, lexical scoping.</li>
<li>Python: <strong>LEGB</strong> (Local–Enclosing–Global–Builtins).</li>
</ul></li>
<li><p><strong>Varargs</strong></p>
<ul>
<li>R: <code>...</code> ↔︎ Python: <code>*args, **kwargs</code>.</li>
</ul></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>OOP gives you <strong>uniform verbs</strong>, <strong>decoupled implementations</strong>, and <strong>extensibility</strong>.</li>
<li>In R, S3 makes this <strong>lightweight</strong> and idiomatic (<code>summary</code>, <code>plot</code>, <code>coef</code>, …).</li>
<li>In Python, classes + <code>@singledispatch</code> cover both <strong>class methods</strong> and <strong>generic functions</strong>.</li>
</ul>
</section>
<section id="case-study-r-s3-a-tiny-smoother-model" class="slide level2">
<h2>Case study (R, S3): a tiny smoother model</h2>
<p><strong>Goal:</strong> Create a simple “model” object that computes a moving-average fit and immediately works with <code>summary()</code> and <code>plot()</code> via S3.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a></a><span class="co"># Tiny moving average helper (base R)</span></span>
<span id="cb104-2"><a></a>movavg <span class="ot">&lt;-</span> <span class="cf">function</span>(z, <span class="at">k =</span> <span class="dv">5</span>) {</span>
<span id="cb104-3"><a></a>  <span class="fu">stopifnot</span>(k <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>, k <span class="sc">&gt;=</span> <span class="dv">3</span>)</span>
<span id="cb104-4"><a></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(z); out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, n); h <span class="ot">&lt;-</span> k <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb104-5"><a></a>  <span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span> <span class="sc">+</span> h)<span class="sc">:</span>(n <span class="sc">-</span> h)) out[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(z[(i <span class="sc">-</span> h)<span class="sc">:</span>(i <span class="sc">+</span> h)])</span>
<span id="cb104-6"><a></a>  out</span>
<span id="cb104-7"><a></a>}</span>
<span id="cb104-8"><a></a></span>
<span id="cb104-9"><a></a><span class="co"># Constructor returning an S3 object of class "my_smooth"</span></span>
<span id="cb104-10"><a></a>my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">k =</span> <span class="dv">5</span>) {</span>
<span id="cb104-11"><a></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb104-12"><a></a>  o <span class="ot">&lt;-</span> <span class="fu">order</span>(x); x <span class="ot">&lt;-</span> x[o]; y <span class="ot">&lt;-</span> y[o]</span>
<span id="cb104-13"><a></a>  <span class="fu">structure</span>(</span>
<span id="cb104-14"><a></a>    <span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">k =</span> k, <span class="at">fitted =</span> <span class="fu">movavg</span>(y, k), <span class="at">call =</span> <span class="fu">match.call</span>()),</span>
<span id="cb104-15"><a></a>    <span class="at">class =</span> <span class="st">"my_smooth"</span></span>
<span id="cb104-16"><a></a>  )</span>
<span id="cb104-17"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="case-study-r-s3-methods-usage" class="slide level2">
<h2>Case study (R, S3): methods + usage</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a></a><span class="co"># Summary method</span></span>
<span id="cb105-2"><a></a>summary.my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(object, ...) {</span>
<span id="cb105-3"><a></a>  res <span class="ot">&lt;-</span> object<span class="sc">$</span>y <span class="sc">-</span> object<span class="sc">$</span>fitted</span>
<span id="cb105-4"><a></a>  <span class="fu">c</span>(<span class="at">n =</span> <span class="fu">length</span>(object<span class="sc">$</span>y),</span>
<span id="cb105-5"><a></a>    <span class="at">k =</span> object<span class="sc">$</span>k,</span>
<span id="cb105-6"><a></a>    <span class="at">mse =</span> <span class="fu">mean</span>(res<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb105-7"><a></a>}</span>
<span id="cb105-8"><a></a></span>
<span id="cb105-9"><a></a><span class="co"># Plot method</span></span>
<span id="cb105-10"><a></a>plot.my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ..., <span class="at">col_points =</span> <span class="st">"grey40"</span>, <span class="at">pch =</span> <span class="dv">19</span>) {</span>
<span id="cb105-11"><a></a>  <span class="fu">plot</span>(x<span class="sc">$</span>x, x<span class="sc">$</span>y, <span class="at">col =</span> col_points, <span class="at">pch =</span> pch,</span>
<span id="cb105-12"><a></a>       <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>, <span class="at">main =</span> <span class="st">"my_smooth fit"</span>, ...)</span>
<span id="cb105-13"><a></a>  <span class="fu">lines</span>(x<span class="sc">$</span>x, x<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb105-14"><a></a>  <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">legend =</span> <span class="fu">paste0</span>(<span class="st">"k = "</span>, x<span class="sc">$</span>k))</span>
<span id="cb105-15"><a></a>}</span>
<span id="cb105-16"><a></a></span>
<span id="cb105-17"><a></a><span class="co"># Fit on 'cars' and use generic verbs</span></span>
<span id="cb105-18"><a></a>m <span class="ot">&lt;-</span> <span class="fu">my_smooth</span>(cars<span class="sc">$</span>dist, cars<span class="sc">$</span>speed, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb105-19"><a></a><span class="fu">summary</span>(m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a></a><span class="fu">plot</span>(m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="case-study-r-s3-what-dispatch-did" class="slide level2">
<h2>Case study (R, S3): what dispatch did</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">summary</span>(m))</span>
<span id="cb107-2"><a></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">plot</span>(m))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Takeaways</strong></p>
<ul>
<li>We created a new <strong>class</strong> (<code>"my_smooth"</code>) with a tiny constructor.</li>
<li>By adding <strong><code>summary.my_smooth</code></strong> and <strong><code>plot.my_smooth</code></strong>, existing verbs <em>just work</em>.</li>
<li>Analyses call generic verbs; class authors decide the behavior.</li>
</ul>
</section>
<section id="case-study-python-the-same-idea-with-classes-singledispatch" class="slide level2">
<h2>Case study (Python): the same idea with classes + <span class="citation" data-cites="singledispatch">@singledispatch</span></h2>
<p><strong>Goal:</strong> Mirror the R idea: a small smoother class, plus generic <code>summarize()</code> and <code>plot()</code> that dispatch on type.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb108-2"><a></a></span>
<span id="cb108-3"><a></a><span class="kw">class</span> Smooth:</span>
<span id="cb108-4"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb108-5"><a></a>        <span class="cf">assert</span> k <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> k <span class="op">&gt;=</span> <span class="dv">3</span></span>
<span id="cb108-6"><a></a>        idx <span class="op">=</span> np.argsort(x)</span>
<span id="cb108-7"><a></a>        <span class="va">self</span>.x <span class="op">=</span> np.array(x)[idx]</span>
<span id="cb108-8"><a></a>        <span class="va">self</span>.y <span class="op">=</span> np.array(y)[idx]</span>
<span id="cb108-9"><a></a>        <span class="va">self</span>.k <span class="op">=</span> k</span>
<span id="cb108-10"><a></a>        <span class="va">self</span>.fitted <span class="op">=</span> <span class="va">self</span>._movavg(<span class="va">self</span>.y, k)</span>
<span id="cb108-11"><a></a></span>
<span id="cb108-12"><a></a>    <span class="kw">def</span> _movavg(<span class="va">self</span>, z, k):</span>
<span id="cb108-13"><a></a>        n <span class="op">=</span> <span class="bu">len</span>(z)<span class="op">;</span> out <span class="op">=</span> np.full(n, np.nan)<span class="op">;</span> h <span class="op">=</span> k <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb108-14"><a></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h, n <span class="op">-</span> h):</span>
<span id="cb108-15"><a></a>            out[i] <span class="op">=</span> np.mean(z[i <span class="op">-</span> h:i <span class="op">+</span> h <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb108-16"><a></a>        <span class="cf">return</span> out</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="case-study-python-generic-functions-usage" class="slide level2">
<h2>Case study (Python): generic functions + usage</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a></a><span class="im">from</span> functools <span class="im">import</span> singledispatch</span>
<span id="cb109-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np, matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb109-3"><a></a></span>
<span id="cb109-4"><a></a><span class="at">@singledispatch</span></span>
<span id="cb109-5"><a></a><span class="kw">def</span> summarize(obj):</span>
<span id="cb109-6"><a></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f"No summarize() for </span><span class="sc">{</span><span class="bu">type</span>(obj)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb109-7"><a></a></span>
<span id="cb109-8"><a></a><span class="at">@summarize.register</span></span>
<span id="cb109-9"><a></a><span class="kw">def</span> _(obj: Smooth):</span>
<span id="cb109-10"><a></a>    res <span class="op">=</span> obj.y <span class="op">-</span> obj.fitted</span>
<span id="cb109-11"><a></a>    <span class="cf">return</span> {<span class="st">"n"</span>: <span class="bu">len</span>(obj.y), <span class="st">"k"</span>: obj.k, <span class="st">"mse"</span>: <span class="bu">float</span>(np.nanmean(res<span class="op">**</span><span class="dv">2</span>))}</span>
<span id="cb109-12"><a></a></span>
<span id="cb109-13"><a></a><span class="at">@singledispatch</span></span>
<span id="cb109-14"><a></a><span class="kw">def</span> plot(obj):</span>
<span id="cb109-15"><a></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f"No plot() for </span><span class="sc">{</span><span class="bu">type</span>(obj)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb109-16"><a></a></span>
<span id="cb109-17"><a></a><span class="at">@plot.register</span></span>
<span id="cb109-18"><a></a><span class="kw">def</span> _(obj: Smooth):</span>
<span id="cb109-19"><a></a>    plt.scatter(obj.x, obj.y, s<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb109-20"><a></a>    plt.plot(obj.x, obj.fitted, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb109-21"><a></a>    plt.title(<span class="ss">f"Smooth (k=</span><span class="sc">{</span>obj<span class="sc">.</span>k<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb109-22"><a></a>    plt.xlabel(<span class="st">"x"</span>)<span class="op">;</span> plt.ylabel(<span class="st">"y"</span>)<span class="op">;</span> plt.show()</span>
<span id="cb109-23"><a></a></span>
<span id="cb109-24"><a></a><span class="co"># Example with 'cars'-like data (replace with real arrays in class)</span></span>
<span id="cb109-25"><a></a>dist <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">122</span>, <span class="dv">2</span>)]</span>
<span id="cb109-26"><a></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">123</span>)</span>
<span id="cb109-27"><a></a>speed <span class="op">=</span> (<span class="fl">0.3</span><span class="op">*</span>np.array(dist) <span class="op">+</span> rng.normal(<span class="dv">0</span>, <span class="dv">3</span>, <span class="bu">len</span>(dist))).tolist()</span>
<span id="cb109-28"><a></a></span>
<span id="cb109-29"><a></a>m <span class="op">=</span> Smooth(dist, speed, k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb109-30"><a></a>summarize(m), plot(m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="case-study" class="slide level2">
<h2>Case study</h2>

<!-- One remote, many devices = same verb, class-specific behavior -->
<img data-src="images/one-remote-many-devices.jpg" class="quarto-figure quarto-figure-center r-stretch" width="560"><ul>
<li><p><strong>Same verb, different types</strong></p>
<ul>
<li>R: <code>summary(m)</code> → finds <code>summary.my_smooth</code>.</li>
<li>Python: <code>summarize(m)</code> → <code>@singledispatch</code> picks the <code>Smooth</code> implementation.</li>
</ul></li>
<li><p><strong>Extensibility</strong></p>
<ul>
<li><p>Add <em>another</em> class (e.g., <code>my_tree</code>) and define just two methods:</p>
<ul>
<li>R: <code>summary.my_tree()</code>, <code>plot.my_tree()</code></li>
<li>Python: <code>@summarize.register(MyTree)</code>, <code>@plot.register(MyTree)</code></li>
</ul></li>
</ul></li>
<li><p><strong>Separation of concerns</strong></p>
<ul>
<li>Analysts keep calling the <em>same verbs</em>; class authors evolve internals safely.</li>
</ul></li>
</ul>
</section>
<section id="oop-exercise-in-r" class="slide level2">
<h2>OOP Exercise in R</h2>
<p><strong>Setup (given):</strong> you have <code>my_smooth(x, y, k)</code> (constructor) with<br>
<code>summary.my_smooth()</code> and <code>plot.my_smooth()</code> from the case study.</p>
<p><strong>A. Create and use an object</strong> 1) Build three models with different windows: <code>k = 3</code>, <code>k = 7</code>, <code>k = 11</code>.<br>
2) Call <code>summary()</code> on each.<br>
3) In 1–2 lines: which <code>k</code> fits best (lower MSE) on your data?</p>
<p><strong>B. Add a tiny exporter</strong> Add an S3 method to convert your object to a simple list:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a></a>as.list.my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb110-2"><a></a>  <span class="fu">list</span>(<span class="at">x =</span> x<span class="sc">$</span>x, <span class="at">y =</span> x<span class="sc">$</span>y, <span class="at">fitted =</span> x<span class="sc">$</span>fitted, <span class="at">k =</span> x<span class="sc">$</span>k, <span class="at">call =</span> x<span class="sc">$</span>call)</span>
<span id="cb110-3"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then run: <code>d &lt;- as.list(m7); names(d)</code> Why is exporting to a plain list handy (think: saving, APIs, tests)?</p>
</section>
<section id="oop-exercise-in-r-continued" class="slide level2">
<h2>OOP Exercise in R (continued)</h2>
<p><strong>C. Make a simple prediction</strong> Add a <code>predict()</code> S3 method using linear interpolation along the fitted curve:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a></a>predict.my_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(object, xnew, ...) {</span>
<span id="cb111-2"><a></a>  <span class="fu">approx</span>(object<span class="sc">$</span>x, object<span class="sc">$</span>fitted, <span class="at">xout =</span> xnew, <span class="at">rule =</span> <span class="dv">2</span>)<span class="sc">$</span>y</span>
<span id="cb111-3"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Try: <code>predict(m7, c(10, 20, 30))</code> and print the results.</p>
<p><strong>D. Plot (optional)</strong> Plot your three models and briefly describe how increasing <code>k</code> changes smoothness:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb112-2"><a></a><span class="fu">plot</span>(m3, <span class="at">main =</span> <span class="st">"k=3"</span>);  <span class="fu">plot</span>(m7, <span class="at">main =</span> <span class="st">"k=7"</span>);  <span class="fu">plot</span>(m11, <span class="at">main =</span> <span class="st">"k=11"</span>)</span>
<span id="cb112-3"><a></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="oop-exercise-in-python" class="slide level2">
<h2>OOP Exercise in Python</h2>
<p><strong>Setup (given):</strong> you have <code>Smooth(x, y, k=5)</code> from the case study, plus:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a></a><span class="at">@singledispatch</span></span>
<span id="cb113-2"><a></a><span class="kw">def</span> summarize(obj): ...</span>
<span id="cb113-3"><a></a><span class="at">@summarize.register</span></span>
<span id="cb113-4"><a></a><span class="kw">def</span> _(m: Smooth): ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>A. Create and use an object</strong></p>
<ol type="1">
<li>Make a <code>Smooth</code> with <code>k = 3</code>, <code>k = 7</code>, <code>k = 11</code>.</li>
<li>Call <code>summarize()</code> on each.</li>
<li>In 1–2 lines: which <code>k</code> fits best (lower MSE) on your data?</li>
</ol>
<p><strong>B. Add a tiny method</strong> Add this method inside <code>Smooth</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a></a><span class="kw">def</span> to_dict(<span class="va">self</span>):</span>
<span id="cb114-2"><a></a>    <span class="cf">return</span> {<span class="st">"x"</span>: <span class="va">self</span>.x.tolist(),</span>
<span id="cb114-3"><a></a>            <span class="st">"y"</span>: <span class="va">self</span>.y.tolist(),</span>
<span id="cb114-4"><a></a>            <span class="st">"fitted"</span>: np.nan_to_num(<span class="va">self</span>.fitted).tolist(),</span>
<span id="cb114-5"><a></a>            <span class="st">"k"</span>: <span class="bu">int</span>(<span class="va">self</span>.k)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then do: <code>d = m.to_dict()</code> and print the keys. Why is this useful?</p>
</section>
<section id="oop-exercise-in-python-continued" class="slide level2">
<h2>OOP Exercise in Python (continued)</h2>
<p><strong>C. Make a simple prediction</strong> Add inside <code>Smooth</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a></a><span class="kw">def</span> predict(<span class="va">self</span>, x_new):</span>
<span id="cb115-2"><a></a>    <span class="co"># linear interpolation on the fitted curve</span></span>
<span id="cb115-3"><a></a>    <span class="cf">return</span> np.interp(x_new, <span class="va">self</span>.x, np.nan_to_num(<span class="va">self</span>.fitted))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Try <code>predict([10, 20, 30])</code> and print the results.</p>
<p><strong>D. Plot (optional)</strong> Make a function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a></a><span class="kw">def</span> quick_plot(m):</span>
<span id="cb116-2"><a></a>    plt.scatter(m.x, m.y, s<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb116-3"><a></a>    plt.plot(m.x, m.fitted, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb116-4"><a></a>    plt.title(<span class="ss">f"Smooth (k=</span><span class="sc">{</span>m<span class="sc">.</span>k<span class="sc">}</span><span class="ss">)"</span>)<span class="op">;</span> plt.xlabel(<span class="st">"x"</span>)<span class="op">;</span> plt.ylabel(<span class="st">"y"</span>)<span class="op">;</span> plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Plot your three models; in 1–2 lines, say how increasing <code>k</code> changes smoothness.</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="functional-programming" class="title-slide slide level1 center">
<h1>Functional Programming</h1>

</section>
<section id="functional-programming-1" class="slide level2">
<h2>Functional programming</h2>
<ul>
<li><p>A paradigm emphasizing <strong>pure</strong> functions (no side effects), <strong>immutability</strong>, and <strong>declarative</strong> style.</p></li>
<li><p>Benefits: maintainable, predictable, and scalable (parallelizable) code.</p></li>
<li><p>Key concepts:</p>
<ul>
<li><strong>Pure</strong> function: same output for same input; no side effects.</li>
<li><strong>First-class</strong> functions: can be passed, returned, stored.</li>
<li><strong>Higher-order</strong> functions: take/return functions.</li>
</ul></li>
</ul>
</section>
<section id="pure-function" class="slide level2">
<h2>Pure function</h2>
<ul>
<li>A pure function always produces the same output for the same input.</li>
<li>Is <code>rnorm</code> a <em>pure</em> function?</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb117-2"><a></a><span class="fu">rnorm</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pure-function-continued" class="slide level2">
<h2>Pure function (continued)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb118-2"><a></a><span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb118-3"><a></a><span class="fu">set.seed</span>(<span class="dv">124</span>)</span>
<span id="cb118-4"><a></a><span class="fu">rnorm</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Same <em>explicit</em> call but different internal RNG state → <code>rnorm</code> is <strong>not</strong> pure.</li>
</ul>
</section>
<section id="first-class-functions-pass-as-argument" class="slide level2">
<h2>First-class functions — pass as argument</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(g) <span class="fu">g</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>))</span>
<span id="cb119-2"><a></a><span class="fu">f</span>(sum); <span class="fu">f</span>(max); <span class="fu">f</span>(mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="first-class-functions-returning-a-function" class="slide level2">
<h2>First-class functions — returning a function</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a></a>makeMultiplier <span class="ot">&lt;-</span> <span class="cf">function</span>(factor) {</span>
<span id="cb120-2"><a></a>  <span class="cf">function</span>(x) x <span class="sc">*</span> factor</span>
<span id="cb120-3"><a></a>}</span>
<span id="cb120-4"><a></a></span>
<span id="cb120-5"><a></a>timesFive <span class="ot">&lt;-</span> <span class="fu">makeMultiplier</span>(<span class="dv">5</span>)</span>
<span id="cb120-6"><a></a><span class="fu">timesFive</span>(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>See <a href="https://adv-r.hadley.nz/function-factories.html">Function factories</a>.</li>
</ul>
</section>
<section id="function-operators-higher-order" class="slide level2">
<h2>Function operators / higher-order</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a></a>applyTwice <span class="ot">&lt;-</span> <span class="cf">function</span>(func) {</span>
<span id="cb121-2"><a></a>  <span class="cf">function</span>(x) <span class="fu">func</span>(<span class="fu">func</span>(x))</span>
<span id="cb121-3"><a></a>}</span>
<span id="cb121-4"><a></a>addTwo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb121-5"><a></a><span class="fu">applyTwice</span>(addTwo)(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>See <a href="https://adv-r.hadley.nz/function-operators.html">Function operators</a>.</li>
</ul>
</section>
<section id="from-for-loops-to-functionals-squares-r" class="slide level2">
<h2>From <code>for</code> loops to functionals — squares (R)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a></a><span class="co"># Using a for loop to calculate squares</span></span>
<span id="cb122-2"><a></a>n <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb122-3"><a></a>result <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, n)</span>
<span id="cb122-4"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) result[[i]] <span class="ot">&lt;-</span> i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb122-5"><a></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a></a><span class="co"># Functional approach with purrr</span></span>
<span id="cb123-2"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb123-3"><a></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> .<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="from-for-loops-to-functionals-sum" class="slide level2">
<h2>From <code>for</code> loops to functionals — sum</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a></a><span class="co"># for loop</span></span>
<span id="cb124-2"><a></a>a <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb124-3"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) a <span class="ot">&lt;-</span> a <span class="sc">+</span> i</span>
<span id="cb124-4"><a></a>a</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a></a><span class="co"># Reduce</span></span>
<span id="cb125-2"><a></a><span class="fu">Reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="purrrmap-r" class="slide level2">
<h2><code>purrr::map()</code> (R)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><code>map(v, f)</code> applies <code>f</code> to each element of <code>v</code> and returns a list.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb126-2"><a></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, exp)</span>
<span id="cb126-3"><a></a><span class="co"># base R equivalent</span></span>
<span id="cb126-4"><a></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, exp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/map.png"></p>
</div></div>
</section>
<section id="returning-atomic-vectors" class="slide level2">
<h2>Returning atomic vectors</h2>
<ul>
<li><code>map</code> / <code>lapply</code> return a <code>list</code>; sometimes you want an atomic vector.</li>
<li>Use <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code>, <code>map_chr()</code> or base <code>sapply</code> / <code>vapply</code>.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a></a><span class="co"># purrr typed maps</span></span>
<span id="cb127-2"><a></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, exp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a></a><span class="co"># base R</span></span>
<span id="cb128-2"><a></a><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, exp)</span>
<span id="cb128-3"><a></a><span class="co"># vapply needs a template</span></span>
<span id="cb128-4"><a></a><span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">FUN =</span> exp, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="inline-anonymous-functions" class="slide level2">
<h2>Inline anonymous functions</h2>
<p>There are situations where the function you want to pass does not exist yet. Use an <em>inline anonymous function</em> (aka <em>lambda</em>).</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a></a><span class="co"># purrr formula shortcut</span></span>
<span id="cb129-2"><a></a><span class="fu">map_int</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="cf">if</span> (.x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) .x<span class="sc">^</span><span class="dv">2</span> <span class="cf">else</span> .x<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a></a><span class="co"># base R anonymous function</span></span>
<span id="cb130-2"><a></a><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(x) <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) x<span class="sc">^</span><span class="dv">2</span> <span class="cf">else</span> x<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="variants-to-purrrmap" class="slide level2">
<h2>Variants to <code>purrr::map()</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>map2</code> takes two vectors <code>v1</code>, <code>v2</code> and a function <code>f</code> and returns <code>f(v1[i], v2[i])</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a></a>wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">15</span></span>
<span id="cb131-2"><a></a>wtL <span class="ot">&lt;-</span> <span class="fu">list</span>(wt, wt, wt)</span>
<span id="cb131-3"><a></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>,<span class="fl">4.5</span>,<span class="dv">5</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="fl">5.5</span>,<span class="dv">5</span>,<span class="fl">4.5</span>,<span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb131-4"><a></a><span class="fu">map2_dbl</span>(x, wtL, weighted.mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/map2-arg.png"></p>
</div></div>
</section>
<section id="pmap-generalization-r" class="slide level2">
<h2><code>pmap</code> generalization (R)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a></a>l1 <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb132-2"><a></a>l2 <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb132-3"><a></a>l3 <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb132-4"><a></a>calculate_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(e1,e2,e3) e1<span class="sc">+</span>e2<span class="sc">+</span>e3</span>
<span id="cb132-5"><a></a><span class="fu">pmap</span>(<span class="fu">list</span>(l1,l2,l3), calculate_sum)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/pmap-3.png"></p>
</div></div>
</section>
<section id="variants-to-sapply-r" class="slide level2">
<h2>Variants to <code>sapply</code> (R)</h2>
<ul>
<li><code>mapply</code> generalizes <code>sapply</code> to many inputs.</li>
<li><code>Map</code> vectorizes over all arguments (no extra non-vectorized input allowed).</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a></a><span class="co"># mapply weighted means</span></span>
<span id="cb133-2"><a></a>wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">15</span></span>
<span id="cb133-3"><a></a>wtL <span class="ot">&lt;-</span> <span class="fu">list</span>(wt, wt, wt)</span>
<span id="cb133-4"><a></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>,<span class="fl">4.5</span>,<span class="dv">5</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="fl">5.5</span>,<span class="dv">5</span>,<span class="fl">4.5</span>,<span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb133-5"><a></a><span class="fu">mapply</span>(<span class="at">FUN =</span> weighted.mean, x, wtL)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a></a><span class="co"># Map over all arguments</span></span>
<span id="cb134-2"><a></a><span class="fu">Map</span>(<span class="at">f =</span> weighted.mean, x, wtL)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="outer-product-r" class="slide level2">
<h2><code>outer</code> product (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a></a><span class="fu">outer</span>(<span class="at">X =</span> <span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>), <span class="at">Y =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>), <span class="at">FUN =</span> paste0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="common-higher-order-functions-in-fp-r" class="slide level2">
<h2>Common higher-order functions in FP (R)</h2>
<ul>
<li><strong>Higher-order</strong> = take/return functions.</li>
<li><code>Reduce</code> applies a binary function iteratively to elements of a vector.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a></a><span class="fu">Reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/reduce.png"></p>
</div></div>
</section>
<section id="rs-vectorization" class="slide level2">
<h2><code>R</code>’s vectorization</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a></a><span class="co"># Using map/lapply</span></span>
<span id="cb137-2"><a></a><span class="fu">library</span>(purrr)</span>
<span id="cb137-3"><a></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, exp)</span>
<span id="cb137-4"><a></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, exp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a></a><span class="co"># But exp is already vectorized</span></span>
<span id="cb138-2"><a></a><span class="fu">exp</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="vectorizing-a-function-r-pitfall-then-fix" class="slide level2">
<h2>Vectorizing a function (R): pitfall then fix</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a></a><span class="co"># return square if even, cube otherwise</span></span>
<span id="cb139-2"><a></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) x<span class="sc">^</span><span class="dv">2</span> <span class="cf">else</span> x<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb139-3"><a></a><span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)  <span class="co"># error: non-scalar if</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="vectorizing-a-function-r-vectorize" class="slide level2">
<h2>Vectorizing a function (R): <code>Vectorize</code></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a></a>vf <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="at">FUN =</span> f, <span class="at">vectorize.args =</span> <span class="st">"x"</span>)</span>
<span id="cb140-2"><a></a><span class="fu">vf</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="vectorizing-a-function-r-ifelse" class="slide level2">
<h2>Vectorizing a function (R): <code>ifelse</code></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a></a><span class="fu">ifelse</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, (<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)<span class="sc">^</span><span class="dv">2</span>, (<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parallelism-r" class="slide level2">
<h2>Parallelism (R)</h2>
<ul>
<li>Benefits of FP include scalability and parallelism.</li>
<li>Many problems are <em>embarrassingly parallel</em>.</li>
<li><code>parallel</code> ships with R and offers parallelized <code>*apply</code> variants.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a></a><span class="fu">library</span>(parallel)</span>
<span id="cb142-2"><a></a><span class="fu">detectCores</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>This is the total number of <strong>threads</strong> (Hyper-Threading), not physical cores.</li>
</ul>
</section>
<section id="forking-with-mclapply-r" class="slide level2">
<h2>Forking with <code>mclapply</code> (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a></a>measure_time <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb143-2"><a></a>  t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>(); <span class="fu">Sys.sleep</span>(x); t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb143-3"><a></a>  <span class="fu">difftime</span>(t2,t1,<span class="at">units=</span><span class="st">"secs"</span>)</span>
<span id="cb143-4"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="forking-with-mclapply-r-1" class="slide level2">
<h2>Forking with <code>mclapply</code> (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a></a><span class="fu">library</span>(parallel)</span>
<span id="cb144-2"><a></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb144-3"><a></a><span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, measure_time, <span class="at">mc.cores =</span> <span class="dv">5</span>)</span>
<span id="cb144-4"><a></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb144-5"><a></a><span class="fu">sprintf</span>(<span class="st">"In total, it took %.1f seconds to run"</span>, <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2,t1,<span class="at">units=</span><span class="st">"secs"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="socket-cluster-with-parlapply-r" class="slide level2">
<h2>Socket cluster with <code>parLapply</code> (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a></a><span class="fu">library</span>(parallel)</span>
<span id="cb145-2"><a></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">5</span>)</span>
<span id="cb145-3"><a></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb145-4"><a></a><span class="fu">parLapply</span>(cl, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, measure_time)</span>
<span id="cb145-5"><a></a>t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="socket-cluster-with-parlapply-r-1" class="slide level2">
<h2>Socket cluster with <code>parLapply</code> (R)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb146-2"><a></a><span class="fu">sprintf</span>(<span class="st">"In total, it took %.1f seconds to run"</span>, <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2,t1,<span class="at">units=</span><span class="st">"secs"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="python-counterparts" class="slide level2">
<h2>Python counterparts</h2>
<ul>
<li>Python is <strong>multi-paradigm</strong>. It supports functional programming (FP) alongside OOP and imperative styles.</li>
<li>Functional tools: <code>map/filter</code>, comprehensions, <code>itertools</code>, <code>functools.reduce/partial/lru_cache</code>.</li>
<li>Vectorization is via <strong>NumPy</strong> (ufuncs). Parallelism via <code>concurrent.futures</code> / <code>multiprocessing</code>.</li>
<li>Defaults are <strong>eager</strong> at definition time (vs.&nbsp;R’s lazy promises); use the <code>None</code> pattern for dynamic defaults.</li>
</ul>
</section>
<section id="to-go-further" class="slide level2">
<h2>To go further</h2>
<ul>
<li>R: <a href="https://adv-r.hadley.nz/functionals.html">Advanced R — Functionals</a>, <a href="https://adv-r.hadley.nz/function-factories.html">Function factories</a>, <a href="https://adv-r.hadley.nz/function-operators.html">Function operators</a>.</li>
<li>R: <code>purrr</code> cheatsheet.</li>
<li>R: <a href="https://bookdown.org/rdpeng/rprogdatascience/loop-functions.html">Loop Functions</a> &amp; <a href="https://bookdown.org/rdpeng/rprogdatascience/parallel-computation.html">Parallel Computation</a> in <em>R Programming for Data Science</em>.</li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="logo_dacm.svg" class="slide-logo"></p>
<div class="footer footer-default">
<p>HEC Lausanne · Business Analytics · Thu 9:00–12:00</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const icon = "";
        const anchorJS = new window.AnchorJS();
        anchorJS.options = {
          placement: 'right',
          icon: icon
        };
        anchorJS.add('.anchored');
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>